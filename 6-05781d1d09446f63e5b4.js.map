{"version":3,"sources":["webpack:///./node_modules/@iframely/embed.js/src/intersection.js","webpack:///./node_modules/@iframely/embed.js/src/events.js","webpack:///./node_modules/@iframely/embed.js/src/widget-click.js","webpack:///./node_modules/@iframely/embed.js/src/messaging.js","webpack:///./node_modules/@iframely/embed.js/src/iframely.js","webpack:///./node_modules/@iframely/embed.js/src/widget-cancel.js","webpack:///./node_modules/@iframely/embed.js/src/lazy-img-placeholder.js","webpack:///./node_modules/@iframely/embed.js/src/widget-resize.js","webpack:///./node_modules/@iframely/embed.js/src/utils.js","webpack:///./node_modules/@iframely/embed.js/src/ahref.js","webpack:///./node_modules/@iframely/embed.js/src/lazy-iframe.js","webpack:///./node_modules/@iframely/embed.js/src/dom-ready.js","webpack:///./node_modules/@iframely/embed.js/src/const.js","webpack:///./node_modules/@iframely/embed.js/src/deprecated.js","webpack:///./node_modules/@iframely/embed.js/src/import.js","webpack:///./node_modules/@iframely/embed.js/src/index.js","webpack:///./node_modules/@iframely/embed.js/src/widget-options.js"],"names":["messaging","iframely","observers","initializedIframesByOptions","window","on","extendOptions","intersection","widget","message","method","iframe","options","margin","optionsKey","JSON","stringify","initializedIframes","indexOf","push","observer","IntersectionObserver","entries","forEach","entry","postMessage","isIntersecting","target","contentWindow","result","threshold","rootMargin","getObserverOptions","getObserver","observe","nextTick","prefixes","i","fnc","length","bind","setImmediate","setTimeout","global","split","callbacksStack","trigger","event","async","args","cb","apply","Array","prototype","slice","call","arguments","triggerAsync","href","location","origin","open","utils","findIframeByContentWindow","iframes","foundIframe","callback","e","parse","data","ex","receiveMessage","src","document","querySelectorAll","replace","domains","DOMAINS","join","getElementsByTagName","findIframe","source","context","concat","CDN","getWidget","url","exports","target_url","parent","config","module","cancelWidget","parentNode","maxWidthWrapper","naNode","parentElement","el","className","found","findParent","text","textContent","innerText","nextSibling","removeChild","console","warn","hidePlaceholderThumbnail","thumb","aspectWrapper","element","count","childNodes","nodeType","Node","TEXT_NODE","ELEMENT_NODE","nonTextChildCount","nth","getNthNonTextChildNode","nodeName","hasAttribute","getAttribute","removeAttribute","thumbHref","query","parseQueryString","_params","param","match","getEndpoint","Object","assign","api_key","key","createElement","setStyles","position","width","height","backgroundImage","backgroundSize","backgroundPosition","iframelyLoaderDiv","setAttribute","LOADER_CLASS","appendChild","paddingTop","getElementComputedStyle","paddingBottom","paddingTopMatch","parseInt","thumbWrapper","top","addPlaceholderThumbnail","addQueryString","img","WaitingWidget","waitingWidget","findWaitingWidget","deactivate","clearLoadingTimeout","registerLoadingTimeout","waitingWidgets","findWaitingWidgetIdx","idx","this","loadCount","that","addEventListener","iframeOnLoad","LAZY_IFRAME_FADE_TIMEOUT","splice","timeoutId","clearTimeout","LAZY_IFRAME_SHOW_TIMEOUT","frame_styles","media","frame_style","str","trim","props","widgetDecorate","keys","borderWidth","frameStylesBorder","style","border","getTotalBorderWidth","oldIframeHeight","getComputedStyle","getPropertyValue","maxWidth","scrolling","aspectRatio","Math","round","currentHeight","widgetResize","resetWrapperBorderStyles","resetIframeBorderStyles","styles","overflow","scripts","SCRIPT_RE","test","SUPPORTED_QUERY_STRING","m2","CDN_RE","cdn","parseQueryStringFromScriptSrc","getElementById","iframelyStyles","id","type","styleSheet","cssText","innerHTML","defineDefaultStyles","requestSizeOfExistingIframes","load","unshift","getIframeWrapper","checkClass","ASPECT_WRAPPER_CLASS","MAXWIDTH_WRAPPER_CLASS","addDefaultWrappers","insertBefore","wrapper","qs","value","currentValue","query_string","toString","values","map","uri","encodeURIComponent","containsString","list","findValue","config_params","endpoint","more_options","iframely_config_keys","protocol","new_value","allowed_query_string","item","decodeURIComponent","container","a","import","elements","dataIframelyUrl","v","VERSION","app","isLazy","lazy","lastChild","unfurl","loadLazyIframe","f","readyState","attachEvent","BASE_RE","ID_RE","CLEAR_WRAPPER_STYLES_TIMEOUT","widgets","events","widgetsCache","loadImportWidget","widgetOptions","importOptions","needCancelWidget","cancel","shadow","hasRenderedEvent","renderEvent","replacedEl","html","shadowContainer","shadowRoot","attachShadow","mode","shadowWidgetOptions","stylesIds","stylesDict","commonShadowStyles","exec_body_scripts","body_el","evalScript","elem","script","createTextNode","child","children_nodes","name","toUpperCase","toLowerCase","clearWrapperStylesAndClass","importReady","failed_elements","parents","head","debug","playerjs","uris","ids","import_options","pushElement","queueElement","mId","skipImport","mBase","sort","touch","isTouch","flash","_hasFlash","fo","ActiveXObject","navigator","mimeTypes","undefined","enabledPlugin","hasFlash","onerror","makeImportAPICall","els","buildImportWidgets","maxTouchPoints","eventHandle","_loaded"],"mappings":"gFAAA,IAAIA,EAAY,EAAQ,QAEpBC,EAAW,EAAQ,QAEnBC,EAAY,GACZC,EAA8B,GAsC9B,yBAA0BC,QAAU,8BAA+BA,SACrEH,EAASI,GAAG,QAAQ,WAClBJ,EAASK,cAAc,CACrBC,aAAc,OAGlBN,EAASI,GAAG,WAAW,SAAUG,EAAQC,GACvC,GAAuB,uBAAnBA,EAAQC,QAAmCF,EAAOG,OAAQ,CAC5D,IAAIC,EAAUH,EAAQG,QAEjBA,IACHA,EAAU,CACRC,OAAQ,MAKZ,IAAIC,EAAaC,KAAKC,UAAUJ,GAC5BK,EAAqBd,EAA4BW,GAAcX,EAA4BW,IAAe,GAE9G,GAAIG,EAAmBC,QAAQV,EAAOG,SAAW,EAE/C,OAGFM,EAAmBE,KAAKX,EAAOG,QA7DrC,SAAqBC,GACnB,IAAIE,EAAaC,KAAKC,UAAUJ,GAC5BQ,EAAWlB,EAAUY,GAiBzB,OAfKM,IACHA,EAAW,IAAIC,sBAAqB,SAAUC,GAC5CA,EAAQC,SAAQ,SAAUC,GACxBxB,EAAUyB,YAAY,CACpBf,OAAQ,eACRc,MAAO,CACLE,eAAgBF,EAAME,gBAExBd,QAASA,GACR,IAAKY,EAAMG,OAAOC,oBAS7B,SAA4BhB,GAC1B,IAAIiB,EAAS,GAETjB,GAAWA,EAAQkB,YACrBD,EAAOC,UAAYlB,EAAQkB,WAGzBlB,GAAWA,EAAQC,SACrBgB,EAAOE,WAAanB,EAAQC,OAAS,MAAQD,EAAQC,OAAS,MAAQD,EAAQC,OAAS,MAAQD,EAAQC,OAAS,MAGlH,OAAOgB,EAlBFG,CAAmBpB,IACtBV,EAAUY,GAAcM,GAGnBA,EA2CHa,CAAYrB,GAASsB,QAAQ1B,EAAOG,c,wBCrE1C,kBAAe,EAAQ,QAEnBwB,EAAW,SAAU/B,EAAQgC,EAAUC,EAAGC,GAC5C,MAAQA,GAAOD,EAAID,EAASG,QAC1BD,EAAMlC,EAAOgC,EAASC,KAAO,wBAG/B,OAAOC,GAAOA,EAAIE,KAAKpC,IAAWA,EAAOqC,cAAgB,SAAUH,GACjElC,EAAOsC,WAAWJ,EAAK,IANZ,CAQK,oBAAXlC,OAAyBA,OAASuC,EAAQ,wBAAwBC,MAAM,KAAM,GAEnFC,EAAiB,GAOrB,SAASC,EAAQC,EAAOC,EAAOC,IAChBJ,EAAeE,IAAU,IAC/BxB,SAAQ,SAAU2B,GACnBF,EACFb,GAAS,WACPe,EAAGC,MAAMlD,EAAUgD,MAGrBC,EAAGC,MAAMlD,EAAUgD,MAIT,SAAVF,IAGFF,EAAeE,GAAS,IApB5B9C,EAASI,GAAK,SAAU0C,EAAOG,IAChBL,EAAeE,GAASF,EAAeE,IAAU,IACvD5B,KAAK+B,IAsBdjD,EAAS6C,QAAU,SAAUC,GAC3B,IAAIE,EAAOG,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GACjDV,EAAQC,GAAO,EAAOE,IAGxBhD,EAASwD,aAAe,SAAUV,GAChC,IAAIE,EAAOG,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GACjDV,EAAQC,GAAO,EAAME,M,6CC7CvB,IAAIhD,EAAW,EAAQ,QAEvBA,EAASI,GAAG,WAAW,SAAUG,EAAQC,GAChB,cAAnBA,EAAQC,QAA6C,UAAnBD,EAAQC,QAC5CT,EAAS6C,QAAQrC,EAAQC,OAAQD,EAAQiD,SAG7CzD,EAASI,GAAG,aAAa,SAAUqD,GACjCzD,EAASwD,aAAa,QAASC,GAEc,IAAzCA,EAAKxC,QAAQd,OAAOuD,SAASC,QAE/BxD,OAAOuD,SAASD,KAAOA,EAGvBtD,OAAOyD,KAAKH,EAAM,SAAU,gB,qBCfhC,IAAIzD,EAAW,EAAQ,QAEnB6D,EAAQ,EAAQ,QAuBpB,SAASC,EAA0BC,EAASpC,GAG1C,IAFA,IAAIqC,EAEK5B,EAAI,EAAGA,EAAI2B,EAAQzB,SAAW0B,EAAa5B,IAAK,CACvD,IAAI1B,EAASqD,EAAQ3B,GAEjB1B,EAAOiB,gBAAkBA,IAC3BqC,EAActD,GAIlB,OAAOsD,GAhCT,SAAwBC,GACtB,SAAShB,EAAGiB,GACV,IAAI1D,EAEJ,IACEA,EAAUM,KAAKqD,MAAMD,EAAEE,MACvB,MAAOC,IAETJ,EAASC,EAAG1D,GAIVL,OAAoB,cAClBA,OAAyB,iBAC3BA,OAAO8D,EAAW,mBAAqB,uBAAuB,UAAWhB,GAAI,GAE7E9C,OAAO8D,EAAW,cAAgB,eAAe,YAAahB,IAmCpEqB,EAAe,SAAUJ,EAAG1D,GAC1B,GAAIA,GAAWA,EAAQC,OAAQ,CAC7B,IAAIuD,EAlBR,SAAoBrD,GAClB,IAAIqD,EAYJ,OAVIrD,EAAQ4D,MAEVP,EAAcF,EADJU,SAASC,iBAAiB,gBAAkB9D,EAAQ4D,IAAIG,QAAQ,WAAY,IAAM,MAC3C/D,EAAQgB,gBAGtDqC,IAEHA,EAAcF,EADJnD,EAAQgE,QAAUH,SAASC,iBAAiB,iBAAmB9D,EAAQgE,SAAW3E,EAAS4E,SAASC,KAAK,qBAAuB,MAAQL,SAASM,qBAAqB,UAC/HnE,EAAQgB,gBAGpDqC,EAKae,CAAW,CAC3BpD,cAAeuC,EAAEc,OACjBT,IAAK/D,EAAQyE,QACbN,QAAS3E,EAAS4E,QAAQM,OAAOlF,EAASmF,OAG5C,GAAInB,EAAa,CACf,IAAIzD,EAASsD,EAAMuB,UAAUpB,GAEzBzD,GAAUC,EAAQ6E,MACpB9E,EAAO8E,IAAM7E,EAAQ6E,KAGvBrF,EAAS6C,QAAQ,UAAWtC,EAAQC,QAK1C8E,EAAQ9D,YAAc,SAAUhB,EAAS+E,EAAY7D,GAC/CvB,OAAoB,cACC,iBAAZK,IACTA,EAAQyE,QAAUT,SAASd,SAASD,MAGtCjD,EAAUM,KAAKC,UAAUP,GACzB+E,EAAaA,GAAc,KAC3B7D,EAASA,GAAUvB,OAAOqF,QAIN,YAAEhF,EAAS+E,EAAWb,QAAQ,sBAAuB,U,mBCvF7E,IAAI1E,EAAWG,OAAOH,SAAWG,OAAOH,UAAY,GACpDA,EAASyF,OAASzF,EAASyF,QAAU,GACrCC,EAAOJ,QAAUtF,G,qBCFjB,IAAIA,EAAW,EAAQ,QAEvBA,EAASI,GAAG,WAAW,SAAUG,EAAQC,GAChB,iBAAnBA,EAAQC,QACVT,EAAS2F,aAAapF,MAI1BP,EAAS2F,aAAe,SAAUpF,GAChC,GAAKA,EAAL,CAgBA,IAAIqF,EAAarF,EAAOsF,iBAAmBtF,EAAOsF,gBAAgBD,WAC9DE,EAASvF,EAAOsF,gBAEpB,GAAI7F,EAASyF,QAAUzF,EAASyF,OAAOD,OAAQ,CAE7C,IAAIO,EAhBN,SAAoBC,EAAIC,GAGtB,IAFA,IAAIC,GAAQ,GAEJA,GAASF,EAAGJ,YAElBM,GADAF,EAAKA,EAAGJ,YACGK,WAAaD,EAAGC,UAAUtD,MAAM,KAAK1B,QAAQgF,IAAc,EAGxE,OAAOC,GAASF,EAQIG,CAAW5F,EAAOsF,gBAAiB7F,EAASyF,OAAOD,QAEnEO,IACFH,EAAaG,EAAcH,WAC3BE,EAASC,GAIb,GAAIxF,EAAO8E,IAAK,CACd,IAAIe,EAAO7F,EAAOG,SAAWH,EAAOG,OAAO2F,aAAe9F,EAAOG,OAAO4F,WACxEtG,EAASwD,aAAa,SAAUjD,EAAO8E,IAAKO,EAAYQ,EAAMN,EAAOS,aAKvEX,EAAWY,YAAYV,QAnCrBW,QAAQC,KAAK,uD,qBCVjB,IAAI7C,EAAQ,EAAQ,QAEhB7D,EAAW,EAAQ,QAsIvB,SAAS2G,EAAyBpG,GAChC,IAAIqG,EAAQrG,EAAOsG,eAvBrB,SAA2BC,GAGzB,IAFA,IAAIC,EAAQ,EAEH3E,EAAI,EAAGA,EAAI0E,EAAQE,WAAW1E,OAAQF,IAAK,CAClD,IAAI4D,EAAKc,EAAQE,WAAW5E,GAE5B,GAAI4D,EAAGiB,WAAaC,KAAKC,UAAW,CAClC,IAAIf,EAAOJ,EAAGK,aAAeL,EAAGM,WAChCF,EAAOA,EAAK1B,QAAQ,SAAU,MAI5BqC,SAEOf,EAAGiB,WAAaC,KAAKE,cAC9BL,IAIJ,OAAOA,EAI6BM,CAAkB9G,EAAOsG,eAAiB,GAxChF,SAAgCS,EAAKR,GAGnC,IAFA,IAAIC,EAAQ,EAEH3E,EAAI,EAAGA,EAAI0E,EAAQE,WAAW1E,OAAQF,IAAK,CAClD,IAAI4D,EAAKc,EAAQE,WAAW5E,GAE5B,GAAI4D,EAAGiB,WAAaC,KAAKC,gBAClB,GAAInB,EAAGiB,WAAaC,KAAKE,aAAc,CAC5C,GAAIE,IAAQP,EACV,OAAOf,EAGTe,MA4B+EQ,CAAuB,EAAGhH,EAAOsG,eAEhHD,GAA4B,QAAnBA,EAAMY,UACjBjH,EAAOsG,cAAcL,YAAYI,GAxIrC5G,EAASI,GAAG,QAAQ,SAAU4F,GAC5B,GAAIA,GAAsB,WAAhBA,EAAGwB,UAAyBxB,EAAGyB,aAAa,sBAAwBzB,EAAGyB,aAAa,cAAgBzB,EAAG0B,aAAa,OAAQ,CACpI1B,EAAG2B,gBAAgB,YACnB,IAAIpH,EAASsD,EAAMuB,UAAUY,GACzBzB,EAAMyB,EAAG0B,aAAa,sBA8B9B,SAAiCnH,EAAQkD,GACvC,IAAImE,EACAC,EAAQhE,EAAMiE,iBAAiBrE,GAE/BsE,EAAU,GAEd,IAAK,IAAIC,KAASH,EACW,IAAvBG,EAAM/G,QAAQ,OAChB8G,EAAQC,GAASH,EAAMG,IAK3B,GAAIvE,EAAKwE,MAAM,iBACbL,EAAY/D,EAAMqE,YAAYzE,EAAKwE,MAAM,uBAAuB,GAAK,iBAAkBE,OAAOC,OAAO,CACnG/C,IAAKwC,EAAMxC,IACXgD,QAASR,EAAMQ,QACfC,IAAKT,EAAMS,KACVP,QACE,KAAItE,EAAKwE,MAAM,kDAGpB,OAFAL,EAAY/D,EAAMqE,YAAYzE,EAAKiB,QAAQ,mDAAoD,gBAAiBqD,GAKlH,IAAInB,EAAQpC,SAAS+D,cAAc,OAEnC1E,EAAM2E,UAAU5B,EAAO,CACrB6B,SAAU,WACVC,MAAO,OACPC,OAAQ,OACRC,gBAAiB,QAAUhB,EAAY,KACvCiB,eAAgB,QAChBC,mBAAoB,WAEtB,IAAIC,EAAoBvE,SAAS+D,cAAc,OAC/CQ,EAAkBC,aAAa,QAAShJ,EAASiJ,cACjDrC,EAAMsC,YAAYH,GAClB,IAAII,EAAanJ,EAASoJ,wBAAwB7I,EAAOsG,cAAe,eACpEwC,EAAgBrJ,EAASoJ,wBAAwB7I,EAAOsG,cAAe,kBACvEyC,EAAkBH,EAAWlB,MAAM,aAGvC,GAFoBqB,GAAmBC,SAASD,EAAgB,KAE3CD,EAAe,CAClC,IAAIG,EAAehF,SAAS+D,cAAc,OAC1C1E,EAAM2E,UAAUgB,EAAc,CAC5BC,IAAK,IAAMN,EACXT,MAAO,OACPC,OAAQ,EACRF,SAAU,WACVY,cAAeA,IAEjBG,EAAaN,YAAYtC,GACzBrG,EAAOsG,cAAcqC,YAAYM,QAEjCjJ,EAAOsG,cAAcqC,YAAYtC,GApFjC8C,CAAwBnJ,EAAQgE,GAChCA,EAAMV,EAAM8F,eAAepF,EAAK,CAC9BqF,IAAK,IAEP5D,EAAGgD,aAAa,oBAAqBzE,GACrC,IAAIsF,EAActJ,GAClBP,EAAS6C,QAAQ,OAAQmD,OAG7BhG,EAASI,GAAG,WAAW,SAAUG,EAAQC,GACvC,IAAIsJ,EAEmB,mBAAnBtJ,EAAQC,SACVkG,EAAyBpG,IACzBuJ,EAAgBC,EAAkBxJ,KACjBuJ,EAAcE,cAGV,gCAAnBxJ,EAAQC,SACVqJ,EAAgBC,EAAkBxJ,KACjBuJ,EAAcG,sBAGV,8BAAnBzJ,EAAQC,SACVqJ,EAAgBC,EAAkBxJ,KACjBuJ,EAAcI,4BAgHnC,IAAIC,EAAiB,GAErB,SAASC,EAAqB7J,GAG5B,IAFA,IAAI6B,EAAI,EAEDA,EAAI+H,EAAe7H,QAAU6H,EAAe/H,GAAG7B,OAAOG,SAAWH,EAAOG,QAC7E0B,IAGF,GAAIA,EAAI+H,EAAe7H,QAAU6H,EAAe/H,GAAG7B,OAAOG,SAAWH,EAAOG,OAC1E,OAAO0B,EAIX,SAAS2H,EAAkBxJ,GACzB,IAAI8J,EAAMD,EAAqB7J,GAE/B,GAAI8J,GAAe,IAARA,EACT,OAAOF,EAAeE,GAc1B,SAASR,EAActJ,GACrB+J,KAAK/J,OAASA,EACd+J,KAAKC,UAAY,EACjB,IAAI7J,EAASH,EAAOG,OAChB8J,EAAOF,KAOXtK,EAASyK,iBAAiB/J,EAAQ,QALlC,WAEE8J,EAAKE,kBAIPJ,KAAKJ,yBACLC,EAAejJ,KAAKoJ,MAGtBT,EAAczG,UAAUsH,aAAe,WAGrC,GAFAJ,KAAKC,YAEkB,IAAnBD,KAAKC,UAAT,CAIAD,KAAKN,aACL,IAAIQ,EAAOF,KACX7H,YAAW,WACTkE,EAAyB6D,EAAKjK,UAC7BP,EAAS2K,4BAGdd,EAAczG,UAAU4G,WAAa,WAxCrC,IACMK,EAwCJC,KAAKL,wBAxCDI,EAAMD,EAyCUE,QAvCD,IAARD,IACTF,EAAeS,OAAOP,EAAK,IAyC/BR,EAAczG,UAAU6G,oBAAsB,WAC5CK,KAAKO,WAAaC,aAAaR,KAAKO,WACpCP,KAAKO,UAAY,MAGnBhB,EAAczG,UAAU8G,uBAAyB,WAC/C,IAAII,KAAKO,UAAT,CAIA,IAAIL,EAAOF,KACXA,KAAKO,UAAYpI,YAAW,WAC1B+H,EAAKE,iBACJ1K,EAAS+K,6B,qBClOd,IAAIlH,EAAQ,EAAQ,QAEhB7D,EAAW,EAAQ,QAEvBA,EAASI,GAAG,WAAW,SAAUG,EAAQC,GACvC,GAAuB,0BAAnBA,EAAQC,QAAyD,WAAnBD,EAAQC,QAA0C,yBAAnBD,EAAQC,OAAmC,CAC1H,IAAIuK,EAAe,KAEfxK,EAAQ4D,MAAQ5D,EAAQ4D,KAAK6G,OAASzK,EAAQ4D,KAAK6G,MAAMC,aAC3D1K,EAAQ4D,KAAK6G,MAAMC,YAAYvI,MAAM,KAAKrB,SAAQ,SAAU6J,GAC1D,GAAmB,KAAfA,EAAIC,QAAiBD,EAAIlK,QAAQ,MAAQ,EAAG,CAC9C,IAAIoK,EAAQF,EAAIxI,MAAM,KAED,IAAjB0I,EAAM/I,UACR0I,EAAeA,GAAgB,IAClBK,EAAM,GAAGD,QAAUC,EAAM,GAAGD,YAI/CE,EAAe/K,EAAQyK,IACK,yBAAnBxK,EAAQC,QAGjB6K,EAAe/K,EAAQ,MAGzB,IAAI0K,EAAQzK,EAAQ4D,MAAQ5D,EAAQ4D,KAAK6G,OAEpCA,GAASzK,EAAQmI,SACpBsC,EAAQ,CACNtC,OAAQnI,EAAQmI,OAChB,YAAa,SAmDrB,SAAsBpI,EAAQ0K,GAC5B,GAAIA,GAAS9C,OAAOoD,KAAKN,GAAO3I,OAAS,GAAK/B,EAAQ,CACpD,IAAIiL,EAjBR,SAA6BjL,GAE3B,IAAIkL,EAAoBlL,EAAOG,QAAUH,EAAOG,OAAOgL,MAAMC,QAAUpL,EAAOsG,eAAiBtG,EAAOsG,cAAc6E,MAAMC,OAEtHH,EAAcC,GAAqBA,EAAkBxD,MAAM,YAAc,EAEzEuD,IACFA,EAAcjC,SAASiC,EAAY,IAEnCA,GAA4B,GAG9B,OAAOA,EAKaI,CAAoBrL,GAClCsL,EAAkB1L,OAAO2L,kBAAoB3L,OAAO2L,iBAAiBvL,EAAOG,QAAQqL,iBAAiB,UACrGC,EAAWf,EAAM,aAEG,iBAAbe,IAETA,GAAYR,GAGd3H,EAAM2E,UAAUjI,EAAOsF,gBAAiB,CACtC,YAAamG,EACb,YAAaf,EAAM,cAAgBA,EAAM,aAAeO,EACxD9C,MAAOuC,EAAMvC,OAASuC,EAAMvC,MAAQ8C,IAGlCP,EAAMgB,WAAa1L,EAAOG,QAC5BH,EAAOG,OAAOsI,aAAa,YAAaiC,EAAMgB,WAGhD,IAAIC,EAAcjB,EAAM,iBAEpBiB,GAAejB,EAAMtC,SACvB9E,EAAM2E,UAAUjI,EAAOsG,cAAe,CACpCwC,cAAe6C,EAAcC,KAAKC,MAAM,IAAaF,GAAe,IAAO,IAAM,EAEjF/C,WAAY+C,GAAejB,EAAM,kBAEjCtC,OAAQuD,EAAc,EAAIjB,EAAMtC,QAAUsC,EAAMtC,OAAS6C,IAK7D,IAAIa,EAAgBlM,OAAO2L,kBAAoB3L,OAAO2L,iBAAiBvL,EAAOG,QAAQqL,iBAAiB,UAEnGF,GAAmBA,IAAoBQ,GACzCrM,EAASwD,aAAa,gBAAiBjD,EAAOG,OAAQmL,EAAiBQ,IApFzEC,CAAa/L,EAAQ0K,OAIzB,IAAIsB,EAA2B,CAC7B,OAAU,GACV,gBAAiB,GACjB,aAAc,GACd,SAAY,IAEVC,EAA0B,CAC5B,OAAU,IACV,gBAAiB,GACjB,aAAc,GACd,SAAY,IAGd,SAASlB,EAAe/K,EAAQkM,GAC1BA,GAAUlM,GAAUA,EAAOG,OACzB+L,EAAO,kBAETA,EAAOC,SAAW,SAClB7I,EAAM2E,UAAUjI,EAAOsG,cAAe4F,IAEtC5I,EAAM2E,UAAUjI,EAAOG,OAAQ+L,IAEvBA,GAAUlM,GAAUA,EAAOG,SACrCmD,EAAM2E,UAAUjI,EAAOsG,cAAe0F,GACtC1I,EAAM2E,UAAUjI,EAAOG,OAAQ8L,M,qBC/DnC,IAAIxM,EAAW,EAAQ,QAEnBD,EAAY,EAAQ,QAExBC,EAASI,GAAG,QAAQ,WAClBJ,EAASK,cA+MX,WAIE,IAFA,IAAIsM,EAAUnI,SAASC,iBAAiB,uDAE/BrC,EAAI,EAAGA,EAAIuK,EAAQrK,OAAQF,IAAK,CACvC,IAAImC,EAAMoI,EAAQvK,GAAGsF,aAAa,OAAOhD,QAAQ,UAAW,KAE5D,GAAI1E,EAAS4M,UAAUC,KAAKtI,GAAM,CAEhC,IAAI5D,EAAUmH,EAAiBvD,EAAKvE,EAAS8M,uBAAuB5H,OAAO,QACvE6H,EAAKxI,EAAI0D,MAAMjI,EAASgN,QAO5B,IALID,GAAMpM,EAAQsM,OAEhBjN,EAASmF,IAAMxE,EAAQsM,KAAOF,EAAG,IAG/B5E,OAAOoD,KAAK5K,GAAS2B,OAAS,EAIhC,OAAO3B,GAOb,MAAO,GA3OgBuM,IA2GzB,WACE,IACIT,EAASjI,SAAS2I,eADC,mBAGvB,IAAKV,EAAQ,CAGX,IAAIW,EAAiB,sOACrBX,EAASjI,SAAS+D,cAAc,UACzB8E,GARc,kBASrBZ,EAAOa,KAAO,WAEVb,EAAOc,WAETd,EAAOc,WAAWC,QAAUJ,EAE5BX,EAAOgB,UAAYL,EAGrB5I,SAASM,qBAAqB,QAAQ,GAAGoE,YAAYuD,IA3HvDiB,GA2OF,SAAsC/I,GAGpC,IAFA,IAAIZ,EAAUS,SAASC,iBAAiB,iBAAmBE,GAAW3E,EAAS4E,SAASC,KAAK,qBAAuB,MAE3GzC,EAAI,EAAGA,EAAI2B,EAAQzB,OAAQF,IAAK,CACvC,IAAI1B,EAASqD,EAAQ3B,GACjBmC,EAAM7D,EAAO6D,KAEbA,EAAI0D,MAAM,0CAA4C1D,EAAI0D,MAAM,uCAClElI,EAAUyB,YAAY,CACpBf,OAAQ,WACP,IAAKC,EAAOiB,gBApPnBgM,CAA6B3N,EAAS4E,QAAQM,OAAOlF,EAASmF,IAAIT,QAAQ,eAAgB,SAG5F1E,EAAS4N,KAAO,WACd,IAAI5K,EAAOG,MAAMC,UAAUC,MAAMC,KAAKC,WACtCP,EAAK6K,QAAQ,QACb7N,EAAS6C,QAAQK,MAAMoH,KAAMtH,IAG/B,IAAI8K,EAAmBxI,EAAQwI,iBAAmB,SAAUpN,EAAQqN,GAClE,IAAIlH,EAAgBnG,EAAOkF,WAE3B,MAAKiB,GAA4C,QAA3BA,EAAcW,UAAsBH,EAAkBR,GAAiB,GAE1FkH,GAAclH,EAAca,aAAa,WAAa1H,EAASgO,uBAAyBD,GAA+C,aAAjClH,EAAc6E,MAAMjD,UAA2B5B,EAAca,aAAa,WAAa1H,EAASgO,sBAFzM,CAMA,IAAInI,EAAkBgB,EAAcjB,WAEpC,MAAKC,GAAgD,QAA7BA,EAAgB2B,UAAsBH,EAAkBxB,GAAmB,GAAKkI,GAAclI,EAAgB6B,aAAa,WAAa1H,EAASiO,yBAA2BF,GAAclI,EAAgB6B,aAAa,WAAa7B,EAAgB6B,aAAa,SAASO,MAAM,cAMxS,MAAO,CACLpB,cAAeA,EACfhB,gBAAiBA,KAIrBP,EAAQ4I,mBAAqB,SAAUlI,GACrC,IAAIJ,EAAaI,EAAGJ,WAChBC,EAAkBrB,SAAS+D,cAAc,OAC7C1C,EAAgBI,UAAYjG,EAASiO,uBACrC,IAAIpH,EAAgBrC,SAAS+D,cAAc,OAI3C,OAHA1B,EAAcZ,UAAYjG,EAASgO,qBACnCnI,EAAgBqD,YAAYrC,GAC5BjB,EAAWuI,aAAatI,EAAiBG,GAClC,CACLa,cAAeA,EACfhB,gBAAiBA,IAIrBP,EAAQF,UAAY,SAAU1E,GAC5B,IAAI0N,EAAUN,EAAiBpN,GAE/B,GAAK0N,EAAL,CAIA,IAAI7N,EAAS,CACXG,OAAQA,EAERmG,cAAeuH,EAAQvH,cACvBhB,gBAAiBuI,EAAQvI,iBAG3B,GAAwB,MAApBnF,EAAO8G,UAAoB9G,EAAO+G,aAAa,QACjDlH,EAAO8E,IAAM3E,EAAOgH,aAAa,aAC5B,GAAIhH,EAAO+G,aAAa,QAAU,OAAOoF,KAAKnM,EAAOgH,aAAa,QAAS,CAChF,IAAI2G,EAAKvG,EAAiBpH,EAAOgH,aAAa,QAE1C2G,EAAGhJ,MACL9E,EAAO8E,IAAMgJ,EAAGhJ,KAIpB,OAAO9E,IAGTP,EAASoJ,wBAA0B,SAAUpD,EAAI0F,GAC/C,OAAOvL,OAAO2L,kBAAoB3L,OAAO2L,iBAAiB9F,GAAI+F,iBAAiBL,IAGjFpG,EAAQkD,UAAY,SAAUxC,EAAIyG,GAC5BzG,GAEFmC,OAAOoD,KAAKkB,GAAQnL,SAAQ,SAAUgH,GACpC,IAAIgG,EAAQ7B,EAAOnE,IAEE,iBAAVgG,GAAuC,iBAAVA,GAAsB,mBAAmBzB,KAAKyB,MACpFA,GAAgB,MAGlB,IAAIC,EAAevI,EAAG0F,MAAMpD,GAEvBnI,OAAO2L,mBACZ9L,EAASoJ,wBAAwBpD,EAAIsC,IAAQgG,GACxB,uBAAhBtI,EAAGC,WAA8C,kBAARqC,IAA4BiG,GAAgB,cAAc1B,KAAKyB,IAChG,cAARhG,GAAiC,SAAVgG,GAAoB,MAAMzB,KAAK0B,MAC3C,SAAVD,IACFA,EAAQ,IAGVtI,EAAG0F,MAAMpD,GAAOgG,GAAS,QA6BjC,IAAI3E,EAAiBrE,EAAQqE,eAAiB,SAAUlG,EAAM9C,GAC5D,IAAI6N,EAAe,GAsBnB,OArBArG,OAAOoD,KAAK5K,GAASW,SAAQ,SAAUgH,GACrC,IAAIgG,EAAQ3N,EAAQ2H,GAEpB,GAA8C,mBAA1CH,OAAO/E,UAAUqL,SAASnL,KAAKgL,GAA6B,CAC9D,IAAII,EAASJ,EAAMK,KAAI,SAAUC,GAC/B,OAAOtG,EAAM,IAAMuG,mBAAmBD,MAExCJ,GAAgB,IAAME,EAAO7J,KAAK,eACR,IAAVyJ,IAAsD,IAA7B7K,EAAKxC,QAAQqH,EAAM,QAE9C,IAAVgG,IACFA,EAAQ,IAGI,IAAVA,IACFA,EAAQ,GAGVE,GAAgB,IAAMlG,EAAM,IAAMuG,mBAAmBP,OAGlD7K,GAAyB,KAAjB+K,GAAuB/K,EAAKxC,QAAQ,MAAQ,EAAI,IAAM,KAAOuN,EAAa9J,QAAQ,KAAM,IAAM,KAoG/G,SAAS2C,EAAkBP,GAGzB,IAFA,IAAIC,EAAQ,EAEH3E,EAAI,EAAGA,EAAI0E,EAAQE,WAAW1E,OAAQF,IAAK,CAClD,IAAI4D,EAAKc,EAAQE,WAAW5E,GAE5B,GAAI4D,EAAGiB,WAAaC,KAAKC,UAAW,CAClC,IAAIf,EAAOJ,EAAGK,aAAeL,EAAGM,WAChCF,EAAOA,EAAK1B,QAAQ,SAAU,MAI5BqC,SAEOf,EAAGiB,WAAaC,KAAKE,cAC9BL,IAIJ,OAAOA,EAGT,SAAS+H,EAAeC,EAAMC,GAI5B,IAHA,IAAIV,EACAlM,EAAI,EAEDA,EAAI2M,EAAKzM,QAAQ,CAGtB,IAFAgM,EAAQS,EAAK3M,KAEA4M,EACX,OAAO,EAGT,GAAIV,GAASA,EAAMzB,MAAQyB,EAAMzB,KAAKmC,GACpC,OAAO,EAGT5M,KAtIJkD,EAAQ4C,YAAc,SAAU3D,EAAK5D,EAASsO,GAC5C,IAAIC,EAAW3K,EAgBf,GAdK,mBAAmBsI,KAAKtI,KAC3B2K,GAAYvO,EAAQwE,KAAOnF,EAASmF,KAAO+J,SACpCvO,EAAQwE,KAGZ,qBAAqB0H,KAAKqC,KAC7BA,EAAW,KAAOA,GAGhBvO,IACFuO,EAAWvF,EAAeuF,EAAUvO,IAIlCsO,GAAiBA,EAAc3M,OAAQ,CAIzC,IAHA,IAAI6M,EAAe,GACfC,EAAuBjH,OAAOoD,KAAKvL,EAASyF,QAEvCrD,EAAI,EAAGA,EAAIgN,EAAqB9M,OAAQF,IAAK,CACpD,IAAIkG,EAAM8G,EAAqBhN,GAE3B0M,EAAeG,EAAe3G,KAChC6G,EAAa7G,GAAOtI,EAASyF,OAAO6C,IAIxC4G,EAAWvF,EAAeuF,EAAUC,GAOtC,MAJI,mBAAmBtC,KAAKqC,KAAcA,EAASjH,MAAM,oBAAoB,IAAqC,UAA/BzD,SAASd,SAAS2L,WACnGH,EAAW,QAAUA,GAGhBA,GAITlP,EAASK,cAAgB,SAAUM,GACjCA,GAAWwH,OAAOoD,KAAK5K,GAASW,SAAQ,SAAUgH,GAChD,IAAIgH,EAA6B,IAAjB3O,EAAQ2H,IAA+B,MAAjB3H,EAAQ2H,KAAiC,IAAjB3H,EAAQ2H,IAAmC,UAAjB3H,EAAQ2H,KAA4C,IAAjB3H,EAAQ2H,IAA+B,MAAjB3H,EAAQ2H,KAAiC,IAAjB3H,EAAQ2H,IAAkC,SAAjB3H,EAAQ2H,IAAyB3H,EAAQ2H,KAE9M,IAAzBtI,EAASyF,OAAO6C,KAElBtI,EAASyF,OAAO6C,GAAOgH,OA4F7B,IAAIxH,EAAmBxC,EAAQwC,iBAAmB,SAAUzC,EAAKkK,GAC/D,IAAI1H,EAAQxC,EAAI4C,MAAM,WAEtB,GAAIJ,EAAO,CAKT,IAHA,IAAIzD,GADJyD,EAAQA,EAAM,IACGlF,MAAM,KACnBf,EAAS,GAEJQ,EAAI,EAAGA,EAAIgC,EAAK9B,OAAQF,IAAK,CACpC,IAAIoN,EAAOpL,EAAKhC,GAAGO,MAAM,KAEpB4M,IAAwBT,EAAeS,EAAsBC,EAAK,MACrE5N,EAAO4N,EAAK,IAAMC,mBAAmBD,EAAK,KAI9C,OAAO5N,EAEP,MAAO,K,qBC7TX,IAAIiC,EAAQ,EAAQ,QAEhB7D,EAAW,EAAQ,QAEvBA,EAASI,GAAG,QAAQ,SAAUsP,EAAWjM,GACvC,GAAIiM,GAAaA,EAAUlI,UAA4B,iBAAT/D,EAAmB,CAC/D,IAAIkM,EAAInL,SAAS+D,cAAc,KAC/BoH,EAAE3G,aAAa,OAAQvF,GACvBiM,EAAUxG,YAAYyG,GACtB3P,EAAS6C,QAAQ,OAAQ8M,OAG7B3P,EAASI,GAAG,QAAQ,SAAU4F,GAC5B,IAAKA,IAAOhG,EAAS4P,OAGnB,IAFA,IAAIC,EAAWrL,SAASC,iBAAiB,+CAEhCrC,EAAI,EAAGA,EAAIyN,EAASvN,OAAQF,IACnCpC,EAAS6C,QAAQ,OAAQgN,EAASzN,OAIxCpC,EAASI,GAAG,QAAQ,SAAU4F,GACxBA,GAAsB,MAAhBA,EAAGwB,WAAqBxB,EAAG0B,aAAa,sBAAwB1B,EAAG0B,aAAa,WAAa1B,EAAGyB,aAAa,oBAKzH,SAAgBzB,GACd,IAAKA,EAAG0B,aAAa,uBAAyB1B,EAAG0B,aAAa,QAC5D,OAGF,IAAInD,EACAuL,EAAkB9J,EAAG0B,aAAa,qBAElCoI,GAAmB,iCAAiCjD,KAAKiD,GAC3DvL,EAAMV,EAAMqE,YAAY4H,EAAiB,CACvCC,EAAG/P,EAASgQ,QACZC,IAAK,KAEGjQ,EAASyF,OAAO4C,SAAWrI,EAASyF,OAAO6C,MAAQtI,EAASmF,IACtEZ,EAAMV,EAAMqE,YAAY,cAAe,CACrC7C,IAAKW,EAAG0B,aAAa,QACrBqI,EAAG/P,EAASgQ,QACZC,IAAK,GACJjQ,EAAS8M,wBAEZrG,QAAQC,KAAK,iFAGf,GAAKnC,EAEE,CACL,IAAI7D,EAAS8D,SAAS+D,cAAc,UACpC7H,EAAOsI,aAAa,kBAAmB,IACvCtI,EAAOsI,aAAa,QAAS,6BAEzBhD,EAAGyB,aAAa,aAClB/G,EAAOsI,aAAa,WAAYhD,EAAG0B,aAAa,aAGlD,IAAIwI,EAASlK,EAAGyB,aAAa,cAAgBzB,EAAGyB,aAAa,aAAe,UAAUoF,KAAKtI,IAAQvE,EAASyF,OAAO0K,KAE/G/J,EAAOJ,EAAGK,aAAeL,EAAGM,UAE5BF,GAAiB,KAATA,IACV1F,EAAO2F,YAAcD,GAGvB,IAAIgI,EAAUvK,EAAMiK,iBAAiB9H,GAAI,GAEzC,GAAIoI,EAEF,KAAOA,EAAQvH,cAAcuJ,WAC3BhC,EAAQvH,cAAcL,YAAY4H,EAAQvH,cAAcuJ,gBAG1DhC,EAAUvK,EAAMqK,mBAAmBlI,GAClBA,EAAGJ,WACTY,YAAYR,GAGzBoI,EAAQvH,cAAcqC,YAAYxI,GAE9BwP,GAEFxP,EAAOsI,aAAa,oBAAqBzE,GACzCvE,EAAS6C,QAAQ,OAAQnC,KAEzBA,EAAOsI,aAAa,MAAOzE,GAC3BvE,EAAS6C,QAAQ,eAAgBnC,SAvCnCsF,EAAG2B,gBAAgB,qBA5BnB0I,CAAOrK,O,qBCvBX,IAAInC,EAAQ,EAAQ,QAEhB7D,EAAW,EAAQ,QAGvBA,EAASI,GAAG,QAAQ,SAAU4F,GAC5B,IAAKA,EAIH,IAFA,IAAI6J,EAAWrL,SAASC,iBAAiB,6BAEhCrC,EAAI,EAAGA,EAAIyN,EAASvN,OAAQF,IACnCpC,EAAS6C,QAAQ,OAAQgN,EAASzN,OAIxCpC,EAASI,GAAG,QAAQ,SAAU4F,GACxBA,GAAsB,WAAhBA,EAAGwB,UAAyBxB,EAAGyB,aAAa,uBAAyBzB,EAAGyB,aAAa,cAAgBzB,EAAG0B,aAAa,QAKjI,SAAwB1B,GACtB,IAAIzF,EAASsD,EAAMuB,UAAUY,GACzBzB,EAAMyB,EAAG0B,aAAa,qBAEtBnH,GAAUgE,IACZA,EAAMV,EAAMqE,YAAY3D,EAAK,CAC3B4L,KAAMnQ,EAASyF,OAAOnF,aACtByP,EAAG/P,EAASgQ,QACZC,IAAK,KAKTjK,EAAGgD,aAAa,MAAOzE,GACvByB,EAAG2B,gBAAgB,qBACnB3H,EAAS6C,QAAQ,eAAgBmD,GAnB/BsK,CAAetK,O,qBChBnB,IAEiCuK,EAF7BvQ,EAAW,EAAQ,QAEUuQ,EASxB,WAEPvQ,EAAS6C,QAAQ,SAVW,aAAxB2B,SAASgM,YAAqD,gBAAxBhM,SAASgM,YAEjD/N,WAAW8N,EAAG,GAGhB/L,SAA2B,iBAAIA,SAA2B,iBAAE,mBAAoB+L,GAAKpQ,OAAOsQ,YAAY,SAAUF,I,qBCTpH,IAAIvQ,EAAW,EAAQ,QAEvBA,EAASgQ,QAAU,EACnBhQ,EAASgO,qBAAuB,sBAChChO,EAASiO,uBAAyB,iBAClCjO,EAASiJ,aAAe,kBACxBjJ,EAAS4E,QAAU,CAAC,gBAAiB,YAAa,aAAc,gBAChE5E,EAASmF,IAAMnF,EAASmF,KAAOnF,EAAS4E,QAAQ,GAEhD5E,EAAS0Q,QAAU,0BACnB1Q,EAAS2Q,MAAQ,0CACjB3Q,EAAS4M,UAAY,4EACrB5M,EAASgN,OAAS,+DAClBhN,EAAS8M,uBAAyB,CAAC,UAAW,MAAO,SAAU,QAAS,WAAY,QAAS,WAAY,QAAS,WAAY,OAAQ,SAAU,SAAU,gBAAiB,WAAY,OAAQ,QAC/L9M,EAAS+K,yBAA2B,IACpC/K,EAAS2K,yBAA2B,IACpC3K,EAAS4Q,6BAA+B,K,qBChBxC,IAAI5Q,EAAW,EAAQ,QAGvBA,EAAS6Q,QAAU7Q,EAAS6Q,SAAW,GACvC7Q,EAAS6Q,QAAQjD,KAAO5N,EAAS4N,KAE5B5N,EAAS8Q,SACZ9Q,EAAS8Q,OAAS,GAClB9Q,EAAS8Q,OAAO1Q,GAAKJ,EAASI,GAC9BJ,EAAS8Q,OAAOjO,QAAU7C,EAAS6C,SAGrC7C,EAASI,GAAG,UAAU,SAAUiF,EAAKO,EAAYQ,EAAMG,GACrD,GAAIlB,GAAOO,GAAcQ,GAAiB,KAATA,EAAa,CAC5C,IAAIuJ,EAAInL,SAAS+D,cAAc,KAC/BoH,EAAE3G,aAAa,OAAQ3D,GACvBsK,EAAE3G,aAAa,SAAU,UACzB2G,EAAE3G,aAAa,MAAO,YACtB2G,EAAEtJ,YAAcD,EAEZG,EACFX,EAAWuI,aAAawB,EAAGpJ,GAE3BX,EAAWsD,YAAYyG,Q,qBCvB7B,IAAI9L,EAAQ,EAAQ,QAEhB7D,EAAW,EAAQ,QAGnB+Q,EAAe,GAgJnB,SAASC,EAAiBC,EAAejL,EAAIkL,GAC3C,IAII3Q,EAJA4Q,EAAmBF,EAAcG,OACjCC,EAASJ,EAAcI,OACvBC,EAAmBL,EAAcM,YACjCnD,EAAUvK,EAAMiK,iBAAiB9H,GAAI,GAGzC,GAAImL,EACF5Q,EAASsD,EAAMuB,UAAUY,GACzBhG,EAAS2F,aAAapF,GAAU,CAC9BsF,gBAAiBG,EACjBtF,OAAQsF,EACRX,IAAKW,EAAG0B,aAAa,cAElB,CAGL,IAAIlC,EAAQgM,EAeZ,IAjBAjR,EAASiE,SAAS+D,cAAc,QACzBkF,UAAYwD,EAAcQ,KAG7BrD,IAAYkD,GAGd9L,EAAS4I,EAAQvH,cAAcjB,WAC/B4L,EAAapD,EAAQvH,cAErBuH,EAAQvI,gBAAgB8B,gBAAgB,WAGxCnC,EAASQ,EAAGJ,WACZ4L,EAAaxL,GAGXqL,EAAQ,CACV,IAAIK,EAAkBlN,SAAS+D,cAAc,OACzCoJ,EAAaD,EAAgBE,aAAa,CAC5CC,KAAM,SAERF,EAAWzI,YAAY3I,GACvB,IAAIuR,EAAsB,CACxBH,WAAYA,EACZD,gBAAiBA,EACjBhC,UAAWlK,EACXP,QAASgM,EAAchM,QACvB8M,UAAWd,EAAcc,UACzBC,WAAYd,EAAce,oBAE5BjS,EAAS6C,QAAQ,qCAAsCiP,GACvDtM,EAAO2I,aAAauD,EAAiBF,GACrCxR,EAAS6C,QAAQ,oCAAqCiP,QAEtDtM,EAAO2I,aAAa5N,EAAQiR,GAqGlC,SAASU,EAAkBC,GAKzB,SAASC,EAAWC,GAClB,IAAIjO,EAAOiO,EAAKjM,MAAQiM,EAAKhM,aAAegM,EAAK5E,WAAa,GAC1D6E,EAAS9N,SAAS+D,cAAc,UAEhC8J,EAAK9N,MACP+N,EAAO/N,IAAM8N,EAAK9N,KAGpB+N,EAAOhF,KAAO,kBAEd,IAEEgF,EAAOpJ,YAAY1E,SAAS+N,eAAenO,IAC3C,MAAOF,GAEPoO,EAAOlM,KAAOhC,EAGhB+N,EAAQjJ,YAAYoJ,GAItB,IACIA,EAEAE,EACApQ,EAJAuK,EAAU,GAEV8F,EAAiBN,EAAQnL,WAI7B,IAAK5E,EAAI,EAAGqQ,EAAerQ,GAAIA,IAC7BoQ,EAAQC,EAAerQ,GAjCDsQ,EAmCF,WAnCJL,EAmCHG,GAlCDhL,UAAY6K,EAAK7K,SAASmL,gBAAkBD,EAAKC,eAkC1BH,EAAMlF,MAAqC,oBAA7BkF,EAAMlF,KAAKsF,eAAoE,2BAA7BJ,EAAMlF,KAAKsF,cAI5GV,EAAkBM,IAHlB7F,EAAQzL,KAAKsR,GACbL,EAAQ3L,YAAYgM,IArCxB,IAAkBH,EAAMK,EA2CxB,IAAKtQ,EAAI,EAAGuK,EAAQvK,GAAIA,KACtBkQ,EAAS3F,EAAQvK,IAENwD,YACT0M,EAAO1M,WAAWY,YAAY8L,GAGhCF,EAAWzF,EAAQvK,IAvJjB8P,CAAkB3R,GAGpBiF,EAAOgB,YAAYgL,GAEfF,GACF7O,YAAW,WACToQ,EAA2BrN,KAC1BxF,EAAS4Q,+BAKlB,SAASkC,WACA9S,EAAS4P,OAIhB,IAFA,IAAImD,EAAkBvO,SAASC,iBAAiB,yCAEvCrC,EAAI,EAAGA,EAAI2Q,EAAgBzQ,OAAQF,IAC1C2Q,EAAgB3Q,GAAGuF,gBAAgB,mBACnC3H,EAAS6C,QAAQ,OAAQkQ,EAAgB3Q,IAqC7C,SAASyQ,EAA2B7M,GAIlC,IAHA,IAAIa,EAAgBb,EAChBgN,EAAU,EAEPnM,GAAiBA,EAAca,aAAa,WAAa1H,EAASgO,sBACvEnH,EAAgBA,EAAcjB,aAC9BoN,EAEc,IAEZnM,EAAgB,MAIpB,IAAIhB,EAAkBgB,GAAiBA,EAAcjB,WAEjDC,GAAmBA,EAAgB6B,aAAa,WAAa1H,EAASiO,yBAExEpH,EAAcc,gBAAgB,SAC9Bd,EAAcc,gBAAgB,SAC9B9B,EAAgB8B,gBAAgB,UA/QpC3H,EAASI,GAAG,QAAQ,SAAU4F,GAE5B,IAAKA,IAAiC,IAA3BhG,EAASyF,OAAOmK,QAoPpBpL,SAASyO,KAAKrB,eAAiB5R,EAASkT,OAAwC,UAA/B1O,SAASd,SAAS2L,UAAuD,WAA/B7K,SAASd,SAAS2L,YAChHrP,EAASyF,OAAO0N,WAAanT,EAASyF,OAAO0K,OArPiBnQ,EAAS4P,OAAQ,CACjF,IAAIC,EAAWrL,SAASC,iBAAiB,+CAErCoL,EAASvN,OAAS,GAmB1B,SAA2BuN,GACzB,IAAIyC,EAAS9N,SAAS+D,cAAc,UAChC6K,EAAO,GACPC,EAAM,GACNC,EAAiB,KAGrB,SAASC,EAAY3E,EAAK5I,GACnB+K,EAAanC,KAChBmC,EAAanC,GAAO,IAGtBmC,EAAanC,GAAK1N,KAAK8E,GAGzB,SAASwN,EAAaxN,GACpB,IAAIzB,EAAMyB,EAAG0B,aAAa,qBACtB+L,EAAMlP,EAAI0D,MAAMjI,EAAS2Q,OACzBtD,EAAKoG,GAAOA,EAAI,GAChB9S,EAAUkD,EAAMiE,iBAAiBvD,EAAKvE,EAAS8M,uBAAuB5H,OAAO,QAC7EG,EAAM1E,EAAQ0E,WAEX1E,EAAQ0E,IAEf,IAAIqO,EAAgC,MAAnB/S,EAAQiP,QAAqC,UAAnBjP,EAAQiP,QAA2C,MAArBjP,EAAQwS,UAAyC,SAArBxS,EAAQwS,SAE7G,IAAKO,EAAY,CACf,IAAIC,EAAQpP,EAAI0D,MAAMjI,EAAS0Q,SAC/B/P,EAAQwE,IAAMwO,GAASA,EAAM,GAIxBL,EAEMxS,KAAKC,UAAUJ,EAASwH,OAAOoD,KAAK5K,GAASiT,UAAY9S,KAAKC,UAAUuS,EAAgBnL,OAAOoD,KAAK+H,GAAgBM,UAC7HF,GAAa,GAFbJ,EAAiB3S,EAMrB,GAAI+S,EAEF1T,EAAS6C,QAAQ,OAAQmD,QACpB,GAAIqH,EACTrH,EAAGgD,aAAa,kBAAmBqE,IAEV,IAArBgG,EAAIpS,QAAQoM,IACdgG,EAAInS,KAAKmM,GAGXkG,EAAYlG,EAAIrH,OACX,CACAX,IACHA,EAAMW,EAAG0B,aAAa,UAGd4L,EAAehL,KAAOgL,EAAejL,SAAWrI,EAASyF,OAAO4C,SAAWrI,EAASyF,OAAO6C,MAE1FjD,GACTW,EAAGgD,aAAa,kBAAmB3D,IAER,IAAvB+N,EAAKnS,QAAQoE,IACf+N,EAAKlS,KAAKmE,GAGZkO,EAAYlO,EAAKW,IAGjBhG,EAAS6C,QAAQ,OAAQmD,IAM/B,IAAK,IAAI5D,EAAI,EAAGA,EAAIyN,EAASvN,OAAQF,IAAK,CACxC,IAAI4D,EAAK6J,EAASzN,IAEb4D,EAAG0B,aAAa,oBAAsB1B,EAAGyB,aAAa,sBACzD+L,EAAaxN,GAIboN,EAAK9Q,OAAS,GAAK+Q,EAAI/Q,OAAS,IAClCgR,EAAiBA,GAAkB,IACpBO,MAAQ7T,EAAS8T,UAChCR,EAAeS,MAmHnB,WACE,IAAIC,GAAY,EAEhB,IACE,IAAIC,EAAK,IAAIC,cAAc,iCAGzBF,IADEC,EAKJ,MAAO/P,GAEL8P,KADEG,UAAUC,WAAqEC,MAAxDF,UAAUC,UAAU,mCAAiDD,UAAUC,UAAU,iCAAiCE,eAOvJ,OAAON,EAtIkBO,GACvBjB,EAAerD,IAAM,EAEjBmD,EAAK9Q,OAAS,IAChBgR,EAAe1E,IAAMwE,GAGnBC,EAAI/Q,OAAS,IACfgR,EAAeD,IAAMA,EAAIxO,KAAK,MAGhCyO,EAAevD,EAAI/P,EAASgQ,QAC5BsC,EAAO/N,IAAMV,EAAMqE,YAAY,iBAAkBoL,EAAgBtT,EAAS8M,wBAE1EwF,EAAOkC,QAAU,WAEf1B,KAGFtO,SAASyO,KAAK/J,YAAYoJ,GAC1BtS,EAAS4P,OAAS0C,IAElBQ,IACA9S,EAAS6C,QAAQ,SA7Hf4R,CAAkB5E,OAIxB7P,EAASI,GAAG,QAAQ,SAAUG,EAAQ2Q,GACpC,GAAI3Q,GAAUA,EAAOqO,MAAQrO,EAAOkR,MAAQlR,EAAO6Q,QAAS,CAC1D,IAAIsD,EAAM3D,EAAaxQ,EAAOqO,KAE9B,GAAI8F,EACF,IAAK,IAAItS,EAAI,EAAGA,EAAIsS,EAAIpS,OAAQF,IAC9B4O,EAAiBzQ,EAAQmU,EAAItS,GAAI8O,UAI9BH,EAAaxQ,EAAOqO,SAmH/B5O,EAAS2U,mBAAqB,SAAUzD,GACtClR,EAAS6C,QAAQ,gBAAiBqO,GAClCA,EAAcL,QAAQvP,SAAQ,SAAUf,GACtCP,EAAS6C,QAAQ,OAAQtC,EAAQ2Q,MAEnC4B,KA8EF9S,EAAS8T,QAAU,WACjB,MAAO,iBAAkB3T,QACtBgU,UAAUS,gBAuDf5U,EAASI,GAAG,sBAAuByS,GAE9B7S,EAASyK,mBACZzK,EAASyK,iBAAmB,SAAU4H,EAAM/E,EAAMuH,GAC3CxC,IAIDA,EAAK5H,iBACP4H,EAAK5H,iBAAiB6C,EAAMuH,GAAa,GAChCxC,EAAK5B,YACd4B,EAAK5B,YAAY,KAAOnD,EAAMuH,GAE9BxC,EAAK,KAAO/E,GAAQuH,M,qBCtS1B,EAAQ,QAER,IAAI7U,EAAW,EAAQ,QAElBA,EAAS8U,UACZ9U,EAAS8U,SAAU,EAEnB,EAAQ,QAER,EAAQ,QAGR,EAAQ,QAER,EAAQ,QAER,EAAQ,QAER,EAAQ,QAER,EAAQ,QAGR,EAAQ,QAER,EAAQ,QAER,EAAQ,QAER,EAAQ,QAER,EAAQ,QAER9U,EAAS6C,QAAQ,SAGnByC,EAAQtF,SAAWA,G,qBCpCnB,IAAIA,EAAW,EAAQ,QAEvBA,EAASI,GAAG,WAAW,SAAUG,EAAQC,GAChB,4BAAnBA,EAAQC,QAEVT,EAAS6C,QAAQ,UAAWtC,EAAQC,EAAQ4D","file":"6-05781d1d09446f63e5b4.js","sourcesContent":["var messaging = require('./messaging');\n\nvar iframely = require('./iframely');\n\nvar observers = {};\nvar initializedIframesByOptions = {};\n\nfunction getObserver(options) {\n  var optionsKey = JSON.stringify(options);\n  var observer = observers[optionsKey];\n\n  if (!observer) {\n    observer = new IntersectionObserver(function (entries) {\n      entries.forEach(function (entry) {\n        messaging.postMessage({\n          method: 'intersection',\n          entry: {\n            isIntersecting: entry.isIntersecting\n          },\n          options: options\n        }, '*', entry.target.contentWindow);\n      });\n    }, getObserverOptions(options));\n    observers[optionsKey] = observer;\n  }\n\n  return observer;\n}\n\nfunction getObserverOptions(options) {\n  var result = {};\n\n  if (options && options.threshold) {\n    result.threshold = options.threshold;\n  }\n\n  if (options && options.margin) {\n    result.rootMargin = options.margin + 'px ' + options.margin + 'px ' + options.margin + 'px ' + options.margin + 'px';\n  }\n\n  return result;\n}\n\nif ('IntersectionObserver' in window && 'IntersectionObserverEntry' in window) {\n  iframely.on('init', function () {\n    iframely.extendOptions({\n      intersection: 1\n    });\n  });\n  iframely.on('message', function (widget, message) {\n    if (message.method === 'send-intersections' && widget.iframe) {\n      var options = message.options;\n\n      if (!options) {\n        options = {\n          margin: 1000\n        };\n      } // Prevent double iframe initialization.\n\n\n      var optionsKey = JSON.stringify(options);\n      var initializedIframes = initializedIframesByOptions[optionsKey] = initializedIframesByOptions[optionsKey] || [];\n\n      if (initializedIframes.indexOf(widget.iframe) > -1) {\n        // Skip initialized iframe.\n        return;\n      }\n\n      initializedIframes.push(widget.iframe);\n      getObserver(options).observe(widget.iframe);\n    }\n  });\n}","var iframely = require('./iframely');\n\nvar nextTick = function (window, prefixes, i, fnc) {\n  while (!fnc && i < prefixes.length) {\n    fnc = window[prefixes[i++] + 'equestAnimationFrame'];\n  }\n\n  return fnc && fnc.bind(window) || window.setImmediate || function (fnc) {\n    window.setTimeout(fnc, 0);\n  };\n}(typeof window !== 'undefined' ? window : global, 'r webkitR mozR msR oR'.split(' '), 0);\n\nvar callbacksStack = {};\n\niframely.on = function (event, cb) {\n  var events = callbacksStack[event] = callbacksStack[event] || [];\n  events.push(cb);\n};\n\nfunction trigger(event, async, args) {\n  var events = callbacksStack[event] || [];\n  events.forEach(function (cb) {\n    if (async) {\n      nextTick(function () {\n        cb.apply(iframely, args);\n      });\n    } else {\n      cb.apply(iframely, args);\n    }\n  });\n\n  if (event === 'init') {\n    // everything inited, let's clear the callstack, just in case\n    // TODO: not good.\n    callbacksStack[event] = [];\n  }\n}\n\niframely.trigger = function (event) {\n  var args = Array.prototype.slice.call(arguments, 1);\n  trigger(event, false, args);\n};\n\niframely.triggerAsync = function (event) {\n  var args = Array.prototype.slice.call(arguments, 1);\n  trigger(event, true, args);\n};","var iframely = require('./iframely');\n\niframely.on('message', function (widget, message) {\n  if (message.method === 'open-href' || message.method === 'click') {\n    iframely.trigger(message.method, message.href);\n  }\n});\niframely.on('open-href', function (href) {\n  iframely.triggerAsync('click', href);\n\n  if (href.indexOf(window.location.origin) === 0) {\n    // Redirect top on same origin.\n    window.location.href = href;\n  } else {\n    // Open new tab on another origin.\n    window.open(href, '_blank', 'noopener');\n  }\n});","var iframely = require('./iframely');\n\nvar utils = require('./utils');\n\nfunction receiveMessage(callback) {\n  function cb(e) {\n    var message;\n\n    try {\n      message = JSON.parse(e.data);\n    } catch (ex) {}\n\n    callback(e, message);\n  } // browser supports window.postMessage\n\n\n  if (window['postMessage']) {\n    if (window['addEventListener']) {\n      window[callback ? 'addEventListener' : 'removeEventListener']('message', cb, !1);\n    } else {\n      window[callback ? 'attachEvent' : 'detachEvent']('onmessage', cb);\n    }\n  }\n}\n\nfunction findIframeByContentWindow(iframes, contentWindow) {\n  var foundIframe;\n\n  for (var i = 0; i < iframes.length && !foundIframe; i++) {\n    var iframe = iframes[i];\n\n    if (iframe.contentWindow === contentWindow) {\n      foundIframe = iframe;\n    }\n  }\n\n  return foundIframe;\n}\n\nfunction findIframe(options) {\n  var foundIframe, iframes;\n\n  if (options.src) {\n    iframes = document.querySelectorAll('iframe[src*=\"' + options.src.replace(/^https?:/, '') + '\"]');\n    foundIframe = findIframeByContentWindow(iframes, options.contentWindow);\n  }\n\n  if (!foundIframe) {\n    iframes = options.domains ? document.querySelectorAll('iframe[src*=\"' + (options.domains || iframely.DOMAINS).join('\"], iframe[src*=\"') + '\"]') : document.getElementsByTagName('iframe');\n    foundIframe = findIframeByContentWindow(iframes, options.contentWindow);\n  }\n\n  return foundIframe;\n}\n\nreceiveMessage(function (e, message) {\n  if (message && message.method) {\n    var foundIframe = findIframe({\n      contentWindow: e.source,\n      src: message.context,\n      domains: iframely.DOMAINS.concat(iframely.CDN)\n    });\n\n    if (foundIframe) {\n      var widget = utils.getWidget(foundIframe);\n\n      if (widget && message.url) {\n        widget.url = message.url;\n      }\n\n      iframely.trigger('message', widget, message);\n    }\n  }\n});\n\nexports.postMessage = function (message, target_url, target) {\n  if (window['postMessage']) {\n    if (typeof message === 'object') {\n      message.context = document.location.href;\n    }\n\n    message = JSON.stringify(message);\n    target_url = target_url || '*';\n    target = target || window.parent; // default to parent\n    // the browser supports window.postMessage, so call it with a targetOrigin\n    // set appropriately, based on the target_url parameter.\n\n    target['postMessage'](message, target_url.replace(/([^:]+:\\/\\/[^/]+).*/, '$1'));\n  }\n};","var iframely = window.iframely = window.iframely || {};\niframely.config = iframely.config || {};\nmodule.exports = iframely;","var iframely = require('./iframely');\n\niframely.on('message', function (widget, message) {\n  if (message.method === 'cancelWidget') {\n    iframely.cancelWidget(widget);\n  }\n});\n\niframely.cancelWidget = function (widget) {\n  if (!widget) {\n    console.warn('iframely.cancelWidget called without widget param');\n    return;\n  }\n\n  function findParent(el, className) {\n    var found = false;\n\n    while (!found && el.parentNode) {\n      el = el.parentNode;\n      found = el.className && el.className.split(' ').indexOf(className) >= 0;\n    }\n\n    return found && el;\n  }\n\n  var parentNode = widget.maxWidthWrapper && widget.maxWidthWrapper.parentNode;\n  var naNode = widget.maxWidthWrapper; // Try remove by parentClass first.\n\n  if (iframely.config && iframely.config.parent) {\n    // Remove by parent class.\n    var parentElement = findParent(widget.maxWidthWrapper, iframely.config.parent);\n\n    if (parentElement) {\n      parentNode = parentElement.parentNode;\n      naNode = parentElement;\n    }\n  }\n\n  if (widget.url) {\n    var text = widget.iframe && (widget.iframe.textContent || widget.iframe.innerText);\n    iframely.triggerAsync('cancel', widget.url, parentNode, text, naNode.nextSibling);\n  } // Re-creating a link if people had it as <a>text</a> is now deprecated (see in deprecated.js)\n  // New use: iframely.on('cancel', function(url, parentNode, text) {...} );\n\n\n  parentNode.removeChild(naNode);\n};","var utils = require('./utils');\n\nvar iframely = require('./iframely');\n\niframely.on('load', function (el) {\n  if (el && el.nodeName === 'IFRAME' && el.hasAttribute('data-iframely-url') && el.hasAttribute('data-img') && !el.getAttribute('src')) {\n    el.removeAttribute('data-img');\n    var widget = utils.getWidget(el);\n    var src = el.getAttribute('data-iframely-url');\n    addPlaceholderThumbnail(widget, src);\n    src = utils.addQueryString(src, {\n      img: 1\n    });\n    el.setAttribute('data-iframely-url', src);\n    new WaitingWidget(widget);\n    iframely.trigger('load', el);\n  }\n});\niframely.on('message', function (widget, message) {\n  var waitingWidget;\n\n  if (message.method === 'widgetRendered') {\n    hidePlaceholderThumbnail(widget);\n    waitingWidget = findWaitingWidget(widget);\n    waitingWidget && waitingWidget.deactivate();\n  }\n\n  if (message.method === 'begin-waiting-widget-render') {\n    waitingWidget = findWaitingWidget(widget);\n    waitingWidget && waitingWidget.clearLoadingTimeout();\n  }\n\n  if (message.method === 'end-waiting-widget-render') {\n    waitingWidget = findWaitingWidget(widget);\n    waitingWidget && waitingWidget.registerLoadingTimeout();\n  }\n});\n\nfunction addPlaceholderThumbnail(widget, href) {\n  var thumbHref;\n  var query = utils.parseQueryString(href); // Extract widget params to invalidate image cache.\n\n  var _params = {};\n\n  for (var param in query) {\n    if (param.indexOf('_') === 0) {\n      _params[param] = query[param];\n    }\n  } // need to run through getEndpoint at least to avoid file:///\n\n\n  if (href.match(/\\/api\\/iframe/)) {\n    thumbHref = utils.getEndpoint(href.match(/^(.+)\\/api\\/iframe/i)[1] + '/api/thumbnail', Object.assign({\n      url: query.url,\n      api_key: query.api_key,\n      key: query.key\n    }, _params));\n  } else if (href.match(/^(?:https?:)?\\/\\/[^/]+\\/[a-zA-Z0-9]+(?:\\?.*)?$/)) {\n    thumbHref = utils.getEndpoint(href.replace(/^((?:https?:)?\\/\\/[^/]+\\/[a-zA-Z0-9]+)((\\?.*)?)$/, '$1/thumbnail'), _params);\n  } else {\n    return;\n  }\n\n  var thumb = document.createElement('div'); // Parent div not always has ASPECT_WRAPPER_CLASS. Need explicit inline styles.\n\n  utils.setStyles(thumb, {\n    position: 'absolute',\n    width: '100%',\n    height: '100%',\n    backgroundImage: \"url('\" + thumbHref + \"')\",\n    backgroundSize: 'cover',\n    backgroundPosition: 'center'\n  });\n  var iframelyLoaderDiv = document.createElement('div');\n  iframelyLoaderDiv.setAttribute('class', iframely.LOADER_CLASS);\n  thumb.appendChild(iframelyLoaderDiv);\n  var paddingTop = iframely.getElementComputedStyle(widget.aspectWrapper, 'padding-top');\n  var paddingBottom = iframely.getElementComputedStyle(widget.aspectWrapper, 'padding-bottom');\n  var paddingTopMatch = paddingTop.match(/^(\\d+)px$/);\n  var paddingTopInt = paddingTopMatch && parseInt(paddingTopMatch[1]);\n\n  if (paddingTopInt && paddingBottom) {\n    var thumbWrapper = document.createElement('div');\n    utils.setStyles(thumbWrapper, {\n      top: '-' + paddingTop,\n      width: '100%',\n      height: 0,\n      position: 'relative',\n      paddingBottom: paddingBottom\n    });\n    thumbWrapper.appendChild(thumb);\n    widget.aspectWrapper.appendChild(thumbWrapper);\n  } else {\n    widget.aspectWrapper.appendChild(thumb);\n  }\n}\n\nfunction getNthNonTextChildNode(nth, element) {\n  var count = 0;\n\n  for (var i = 0; i < element.childNodes.length; i++) {\n    var el = element.childNodes[i];\n\n    if (el.nodeType === Node.TEXT_NODE) {// Nop.\n    } else if (el.nodeType === Node.ELEMENT_NODE) {\n      if (nth === count) {\n        return el;\n      }\n\n      count++;\n    }\n  }\n}\n\nfunction nonTextChildCount(element) {\n  var count = 0;\n\n  for (var i = 0; i < element.childNodes.length; i++) {\n    var el = element.childNodes[i];\n\n    if (el.nodeType === Node.TEXT_NODE) {\n      var text = el.textContent || el.innerText;\n      text = text.replace(/\\s|\\n/g, '');\n\n      if (text) {\n        // Do not skip text node with text.\n        count++;\n      }\n    } else if (el.nodeType === Node.ELEMENT_NODE) {\n      count++;\n    }\n  }\n\n  return count;\n}\n\nfunction hidePlaceholderThumbnail(widget) {\n  var thumb = widget.aspectWrapper && nonTextChildCount(widget.aspectWrapper) > 1 && getNthNonTextChildNode(1, widget.aspectWrapper);\n\n  if (thumb && thumb.nodeName === 'DIV') {\n    widget.aspectWrapper.removeChild(thumb);\n  }\n} //===\n// Working WaitingWidgets' collection.\n\n\nvar waitingWidgets = [];\n\nfunction findWaitingWidgetIdx(widget) {\n  var i = 0;\n\n  while (i < waitingWidgets.length && waitingWidgets[i].widget.iframe !== widget.iframe) {\n    i++;\n  }\n\n  if (i < waitingWidgets.length && waitingWidgets[i].widget.iframe === widget.iframe) {\n    return i;\n  }\n}\n\nfunction findWaitingWidget(widget) {\n  var idx = findWaitingWidgetIdx(widget);\n\n  if (idx || idx === 0) {\n    return waitingWidgets[idx];\n  }\n}\n\nfunction removeWaitingWidget(widget) {\n  var idx = findWaitingWidgetIdx(widget);\n\n  if (idx || idx === 0) {\n    waitingWidgets.splice(idx, 1);\n  }\n} //===\n// WaitingWidget proto.\n\n\nfunction WaitingWidget(widget) {\n  this.widget = widget;\n  this.loadCount = 0;\n  var iframe = widget.iframe;\n  var that = this;\n\n  function iframeOnLoad() {\n    // Bind method to self.\n    that.iframeOnLoad();\n  }\n\n  iframely.addEventListener(iframe, 'load', iframeOnLoad);\n  this.registerLoadingTimeout();\n  waitingWidgets.push(this);\n}\n\nWaitingWidget.prototype.iframeOnLoad = function () {\n  this.loadCount++; // Skip first load of hosted widget OR timeout call.\n\n  if (this.loadCount !== 2) {\n    return;\n  }\n\n  this.deactivate();\n  var that = this;\n  setTimeout(function () {\n    hidePlaceholderThumbnail(that.widget);\n  }, iframely.LAZY_IFRAME_FADE_TIMEOUT);\n};\n\nWaitingWidget.prototype.deactivate = function () {\n  this.clearLoadingTimeout();\n  removeWaitingWidget(this);\n};\n\nWaitingWidget.prototype.clearLoadingTimeout = function () {\n  this.timeoutId && clearTimeout(this.timeoutId);\n  this.timeoutId = null;\n};\n\nWaitingWidget.prototype.registerLoadingTimeout = function () {\n  if (this.timeoutId) {\n    return;\n  }\n\n  var that = this;\n  this.timeoutId = setTimeout(function () {\n    that.iframeOnLoad();\n  }, iframely.LAZY_IFRAME_SHOW_TIMEOUT);\n};","var utils = require('./utils');\n\nvar iframely = require('./iframely');\n\niframely.on('message', function (widget, message) {\n  if (message.method === 'setIframelyWidgetSize' || message.method === 'resize' || message.method === 'setIframelyEmbedData') {\n    var frame_styles = null;\n\n    if (message.data && message.data.media && message.data.media.frame_style) {\n      message.data.media.frame_style.split(';').forEach(function (str) {\n        if (str.trim() !== '' && str.indexOf(':') > -1) {\n          var props = str.split(':');\n\n          if (props.length === 2) {\n            frame_styles = frame_styles || {};\n            frame_styles[props[0].trim()] = props[1].trim();\n          }\n        }\n      });\n      widgetDecorate(widget, frame_styles);\n    } else if (message.method === 'setIframelyEmbedData') {\n      // setIframelyEmbedData always sets frame_style. If not - reset.\n      // setIframelyEmbedData without message.data resets border.\n      widgetDecorate(widget, null);\n    }\n\n    var media = message.data && message.data.media;\n\n    if (!media && message.height) {\n      media = {\n        height: message.height,\n        'max-width': 'keep'\n      };\n    }\n\n    widgetResize(widget, media);\n  }\n}); // All frame_style attributes.\n\nvar resetWrapperBorderStyles = {\n  'border': '',\n  'border-radius': '',\n  'box-shadow': '',\n  'overflow': ''\n};\nvar resetIframeBorderStyles = {\n  'border': '0',\n  'border-radius': '',\n  'box-shadow': '',\n  'overflow': ''\n};\n\nfunction widgetDecorate(widget, styles) {\n  if (styles && widget && widget.iframe) {\n    if (styles['border-radius']) {\n      // fix for Chrome?\n      styles.overflow = 'hidden';\n      utils.setStyles(widget.aspectWrapper, styles);\n    } else {\n      utils.setStyles(widget.iframe, styles);\n    }\n  } else if (!styles && widget && widget.iframe) {\n    utils.setStyles(widget.aspectWrapper, resetWrapperBorderStyles);\n    utils.setStyles(widget.iframe, resetIframeBorderStyles);\n  }\n}\n\nfunction getTotalBorderWidth(widget) {\n  // Get frame style from iframe or aspect wrapper as in widgetDecorate for Chrome fix.\n  var frameStylesBorder = widget.iframe && widget.iframe.style.border || widget.aspectWrapper && widget.aspectWrapper.style.border; // Get iframe border width from frame style.\n\n  var borderWidth = frameStylesBorder && frameStylesBorder.match(/(\\d+)px/) || 0;\n\n  if (borderWidth) {\n    borderWidth = parseInt(borderWidth[1]); // For width and height border size will be 2x.\n\n    borderWidth = borderWidth * 2;\n  }\n\n  return borderWidth;\n}\n\nfunction widgetResize(widget, media) {\n  if (media && Object.keys(media).length > 0 && widget) {\n    var borderWidth = getTotalBorderWidth(widget);\n    var oldIframeHeight = window.getComputedStyle && window.getComputedStyle(widget.iframe).getPropertyValue('height');\n    var maxWidth = media['max-width'];\n\n    if (typeof maxWidth === 'number') {\n      // Can be max-width: 56vh.\n      maxWidth += borderWidth;\n    }\n\n    utils.setStyles(widget.maxWidthWrapper, {\n      'max-width': maxWidth,\n      'min-width': media['min-width'] && media['min-width'] + borderWidth,\n      width: media.width && media.width + borderWidth\n    });\n\n    if (media.scrolling && widget.iframe) {\n      widget.iframe.setAttribute('scrolling', media.scrolling);\n    }\n\n    var aspectRatio = media['aspect-ratio']; // If no aspect and height - do not change aspect wrapper.\n\n    if (aspectRatio || media.height) {\n      utils.setStyles(widget.aspectWrapper, {\n        paddingBottom: aspectRatio ? Math.round(1000 * 100 / aspectRatio) / 1000 + '%' : 0,\n        // if fixed-size, it will get set to 0\n        paddingTop: aspectRatio && media['padding-bottom'],\n        // if a fixed-height padding at the bottom of responsive div is required\n        height: aspectRatio ? 0 : media.height && media.height + borderWidth // if defined\n\n      });\n    }\n\n    var currentHeight = window.getComputedStyle && window.getComputedStyle(widget.iframe).getPropertyValue('height');\n\n    if (oldIframeHeight && oldIframeHeight !== currentHeight) {\n      iframely.triggerAsync('heightChanged', widget.iframe, oldIframeHeight, currentHeight);\n    }\n  }\n}","var iframely = require('./iframely');\n\nvar messaging = require('./messaging');\n\niframely.on('init', function () {\n  iframely.extendOptions(parseQueryStringFromScriptSrc()); // if it's hosted from elsewhere - we don't support customizing via query-string. \n  // iframely.CDN will be default one unless changed by user (?cdn= or iframely.CDN= )\n\n  defineDefaultStyles();\n  requestSizeOfExistingIframes(iframely.DOMAINS.concat(iframely.CDN.replace(/^https?:\\/\\//, '')));\n});\n\niframely.load = function () {\n  var args = Array.prototype.slice.call(arguments);\n  args.unshift('load');\n  iframely.trigger.apply(this, args);\n};\n\nvar getIframeWrapper = exports.getIframeWrapper = function (iframe, checkClass) {\n  var aspectWrapper = iframe.parentNode;\n\n  if (!aspectWrapper || aspectWrapper.nodeName !== 'DIV' || nonTextChildCount(aspectWrapper) > 2\n  /* 2 is lazy-cover */\n  || checkClass && aspectWrapper.getAttribute('class') !== iframely.ASPECT_WRAPPER_CLASS || !checkClass && aspectWrapper.style.position !== 'relative' && aspectWrapper.getAttribute('class') !== iframely.ASPECT_WRAPPER_CLASS) {\n    return;\n  }\n\n  var maxWidthWrapper = aspectWrapper.parentNode;\n\n  if (!maxWidthWrapper || maxWidthWrapper.nodeName !== 'DIV' || nonTextChildCount(maxWidthWrapper) > 1 || checkClass && maxWidthWrapper.getAttribute('class') !== iframely.MAXWIDTH_WRAPPER_CLASS || !checkClass && maxWidthWrapper.getAttribute('class') && !maxWidthWrapper.getAttribute('class').match(/iframely/i)\n  /* users can modify class */\n  ) {\n    return;\n  }\n\n  return {\n    aspectWrapper: aspectWrapper,\n    maxWidthWrapper: maxWidthWrapper\n  };\n};\n\nexports.addDefaultWrappers = function (el) {\n  var parentNode = el.parentNode;\n  var maxWidthWrapper = document.createElement('div');\n  maxWidthWrapper.className = iframely.MAXWIDTH_WRAPPER_CLASS;\n  var aspectWrapper = document.createElement('div');\n  aspectWrapper.className = iframely.ASPECT_WRAPPER_CLASS;\n  maxWidthWrapper.appendChild(aspectWrapper);\n  parentNode.insertBefore(maxWidthWrapper, el);\n  return {\n    aspectWrapper: aspectWrapper,\n    maxWidthWrapper: maxWidthWrapper\n  };\n};\n\nexports.getWidget = function (iframe) {\n  var wrapper = getIframeWrapper(iframe);\n\n  if (!wrapper) {\n    return;\n  }\n\n  var widget = {\n    iframe: iframe,\n    // can actually be ahref\n    aspectWrapper: wrapper.aspectWrapper,\n    maxWidthWrapper: wrapper.maxWidthWrapper\n  };\n\n  if (iframe.nodeName === 'A' && iframe.hasAttribute('href')) {\n    widget.url = iframe.getAttribute('href');\n  } else if (iframe.hasAttribute('src') && /url=/.test(iframe.getAttribute('src'))) {\n    var qs = parseQueryString(iframe.getAttribute('src'));\n\n    if (qs.url) {\n      widget.url = qs.url;\n    }\n  }\n\n  return widget;\n};\n\niframely.getElementComputedStyle = function (el, style) {\n  return window.getComputedStyle && window.getComputedStyle(el).getPropertyValue(style);\n};\n\nexports.setStyles = function (el, styles) {\n  if (el) {\n    // let's check it's still defined, just in case\n    Object.keys(styles).forEach(function (key) {\n      var value = styles[key];\n\n      if (typeof value === 'number' || typeof value === 'string' && /^(\\d+)?\\.?(\\d+)$/.test(value)) {\n        value = value + 'px';\n      }\n\n      var currentValue = el.style[key];\n\n      if (!window.getComputedStyle || // don't change CSS values in pixels, such as height:0\n      iframely.getElementComputedStyle(el, key) != value // && don't set default aspect ratio if it's defined in CSS anyway\n      && !(el.className == 'iframely-responsive' && key === 'paddingBottom' && !currentValue && /^56\\.2\\d+%$/.test(value)) // && do not change max-width if new value === 'keep' and old value is vh.\n      && !(key === 'max-width' && value === 'keep' && /vh$/.test(currentValue))) {\n        if (value === 'keep') {\n          value = '';\n        }\n\n        el.style[key] = value || ''; // remove style that is no longer needed\n      }\n    });\n  }\n};\n\nfunction defineDefaultStyles() {\n  var iframelyStylesId = 'iframely-styles';\n  var styles = document.getElementById(iframelyStylesId);\n\n  if (!styles) {\n    // copy-paste default styles from https://iframely.com/docs/omit-css\n    // box-sizing:border-box - need for iOS Safari .\n    var iframelyStyles = '.iframely-responsive{top:0;left:0;width:100%;height:0;position:relative;padding-bottom:56.25%;box-sizing:border-box;}.iframely-responsive>*{top:0;left:0;width:100%;height:100%;position:absolute;border:0;box-sizing:border-box;}';\n    styles = document.createElement('style');\n    styles.id = iframelyStylesId;\n    styles.type = 'text/css';\n\n    if (styles.styleSheet) {\n      // IE.\n      styles.styleSheet.cssText = iframelyStyles;\n    } else {\n      styles.innerHTML = iframelyStyles;\n    }\n\n    document.getElementsByTagName('head')[0].appendChild(styles);\n  }\n}\n\nvar addQueryString = exports.addQueryString = function (href, options) {\n  var query_string = '';\n  Object.keys(options).forEach(function (key) {\n    var value = options[key]; // array is used e.g. for import: uris and ids\n\n    if (Object.prototype.toString.call(value) === '[object Array]') {\n      var values = value.map(function (uri) {\n        return key + '=' + encodeURIComponent(uri);\n      });\n      query_string += '&' + values.join('&');\n    } else if (typeof value !== 'undefined' && href.indexOf(key + '=') === -1) {\n      // set explicitely in options, skip undefines\n      if (value === true) {\n        value = 1;\n      }\n\n      if (value === false) {\n        value = 0;\n      }\n\n      query_string += '&' + key + '=' + encodeURIComponent(value);\n    }\n  });\n  return href + (query_string !== '' ? (href.indexOf('?') > -1 ? '&' : '?') + query_string.replace(/^&/, '') : '');\n};\n\nexports.getEndpoint = function (src, options, config_params) {\n  var endpoint = src;\n\n  if (!/^(https?:)?\\/\\//i.test(src)) {\n    endpoint = (options.CDN || iframely.CDN) + endpoint;\n    delete options.CDN;\n  }\n\n  if (!/^(?:https?:)?\\/\\//i.test(endpoint)) {\n    endpoint = '//' + endpoint;\n  }\n\n  if (options) {\n    endpoint = addQueryString(endpoint, options);\n  } // get additional params from config\n\n\n  if (config_params && config_params.length) {\n    var more_options = {};\n    var iframely_config_keys = Object.keys(iframely.config);\n\n    for (var i = 0; i < iframely_config_keys.length; i++) {\n      var key = iframely_config_keys[i];\n\n      if (containsString(config_params, key)) {\n        more_options[key] = iframely.config[key];\n      }\n    }\n\n    endpoint = addQueryString(endpoint, more_options);\n  }\n\n  if (/^(https?:)?\\/\\//i.test(endpoint) && !endpoint.match(/^(https?:)?\\/\\//i)[1] && document.location.protocol === 'file:') {\n    endpoint = 'http:' + endpoint;\n  }\n\n  return endpoint;\n}; // helper method to init more options through js code\n\n\niframely.extendOptions = function (options) {\n  options && Object.keys(options).forEach(function (key) {\n    var new_value = options[key] === 0 || options[key] === '0' || options[key] === false || options[key] === 'false' ? false : options[key] === 1 || options[key] === '1' || options[key] === true || options[key] === 'true' ? true : options[key];\n\n    if (iframely.config[key] !== false) {\n      // set new value only when undefined or not previously disabled\n      iframely.config[key] = new_value;\n    }\n  });\n};\n\nfunction parseQueryStringFromScriptSrc() {\n  // Extract global iframely params.\n  var scripts = document.querySelectorAll('script[src*=\"embed.js\"], script[src*=\"iframely.js\"]');\n\n  for (var i = 0; i < scripts.length; i++) {\n    var src = scripts[i].getAttribute('src').replace(/&amp;/gi, '&');\n\n    if (iframely.SCRIPT_RE.test(src)) {\n      // found the script on custom origin or default Iframely CDN\n      var options = parseQueryString(src, iframely.SUPPORTED_QUERY_STRING.concat('cdn'));\n      var m2 = src.match(iframely.CDN_RE);\n\n      if (m2 || options.cdn) {\n        // ignore non-Iframely hosts such as s.imgur.com/min/embed.js\n        iframely.CDN = options.cdn || m2[1];\n      }\n\n      if (Object.keys(options).length > 0) {\n        // give preferrence to CDN from scripts that have query-string. \n        // CDN is most critical for embeds with empty data-iframely-url\n        // and those should have at least ?api_key... in script src\n        return options;\n      } // or keep searching\n\n    }\n  } // should have exited by now if any querystring found...\n\n\n  return {};\n}\n\nfunction requestSizeOfExistingIframes(domains) {\n  var iframes = document.querySelectorAll('iframe[src*=\"' + (domains || iframely.DOMAINS).join('\"], iframe[src*=\"') + '\"]');\n\n  for (var i = 0; i < iframes.length; i++) {\n    var iframe = iframes[i];\n    var src = iframe.src;\n\n    if (src.match(/^(https?:)?\\/\\/[^/]+\\/api\\/iframe\\?.+/) || src.match(/^(https?:)?\\/\\/[^/]+\\/\\w+(\\?.*)?$/)) {\n      messaging.postMessage({\n        method: 'getSize'\n      }, '*', iframe.contentWindow);\n    }\n  }\n}\n\nfunction nonTextChildCount(element) {\n  var count = 0;\n\n  for (var i = 0; i < element.childNodes.length; i++) {\n    var el = element.childNodes[i];\n\n    if (el.nodeType === Node.TEXT_NODE) {\n      var text = el.textContent || el.innerText;\n      text = text.replace(/\\s|\\n/g, '');\n\n      if (text) {\n        // Do not skip text node with text.\n        count++;\n      }\n    } else if (el.nodeType === Node.ELEMENT_NODE) {\n      count++;\n    }\n  }\n\n  return count;\n}\n\nfunction containsString(list, findValue) {\n  var value,\n      i = 0;\n\n  while (i < list.length) {\n    value = list[i];\n\n    if (value == findValue) {\n      return true;\n    }\n\n    if (value && value.test && value.test(findValue)) {\n      return true;\n    }\n\n    i++;\n  }\n}\n\nvar parseQueryString = exports.parseQueryString = function (url, allowed_query_string) {\n  var query = url.match(/\\?(.+)/i);\n\n  if (query) {\n    query = query[1];\n    var data = query.split('&');\n    var result = {};\n\n    for (var i = 0; i < data.length; i++) {\n      var item = data[i].split('=');\n\n      if (!allowed_query_string || containsString(allowed_query_string, item[0])) {\n        result[item[0]] = decodeURIComponent(item[1]);\n      }\n    }\n\n    return result;\n  } else {\n    return {};\n  }\n};","var utils = require('./utils');\n\nvar iframely = require('./iframely');\n\niframely.on('load', function (container, href) {\n  if (container && container.nodeName && typeof href === 'string') {\n    var a = document.createElement('a');\n    a.setAttribute('href', href);\n    container.appendChild(a);\n    iframely.trigger('load', a);\n  }\n});\niframely.on('load', function (el) {\n  if (!el && !iframely.import) {\n    var elements = document.querySelectorAll('a[data-iframely-url]:not([data-import-uri])');\n\n    for (var i = 0; i < elements.length; i++) {\n      iframely.trigger('load', elements[i]);\n    }\n  }\n});\niframely.on('load', function (el) {\n  if (el && el.nodeName === 'A' && (el.getAttribute('data-iframely-url') || el.getAttribute('href')) && !el.hasAttribute('data-import-uri')) {\n    unfurl(el);\n  }\n});\n\nfunction unfurl(el) {\n  if (!el.getAttribute('data-iframely-url') && !el.getAttribute('href')) {\n    return; // isn't valid\n  }\n\n  var src;\n  var dataIframelyUrl = el.getAttribute('data-iframely-url');\n\n  if (dataIframelyUrl && /^((?:https?:)?\\/\\/[^/]+)\\/\\w+/i.test(dataIframelyUrl)) {\n    src = utils.getEndpoint(dataIframelyUrl, {\n      v: iframely.VERSION,\n      app: 1\n    });\n  } else if ((iframely.config.api_key || iframely.config.key) && iframely.CDN) {\n    src = utils.getEndpoint('/api/iframe', {\n      url: el.getAttribute('href'),\n      v: iframely.VERSION,\n      app: 1\n    }, iframely.SUPPORTED_QUERY_STRING);\n  } else {\n    console.warn('Iframely cannot build embeds: api key is required as query-string of embed.js');\n  }\n\n  if (!src) {\n    el.removeAttribute('data-iframely-url');\n  } else {\n    var iframe = document.createElement('iframe');\n    iframe.setAttribute('allowfullscreen', '');\n    iframe.setAttribute('allow', 'autoplay; encrypted-media');\n\n    if (el.hasAttribute('data-img')) {\n      iframe.setAttribute('data-img', el.getAttribute('data-img'));\n    }\n\n    var isLazy = el.hasAttribute('data-lazy') || el.hasAttribute('data-img') || /&lazy=1/.test(src) || iframely.config.lazy; // support restoring failed links by its text\n\n    var text = el.textContent || el.innerText;\n\n    if (text && text !== '') {\n      iframe.textContent = text;\n    }\n\n    var wrapper = utils.getIframeWrapper(el, true);\n\n    if (wrapper) {\n      // Delete all in aspect wrapper.\n      while (wrapper.aspectWrapper.lastChild) {\n        wrapper.aspectWrapper.removeChild(wrapper.aspectWrapper.lastChild);\n      }\n    } else {\n      wrapper = utils.addDefaultWrappers(el);\n      var parentNode = el.parentNode;\n      parentNode.removeChild(el);\n    }\n\n    wrapper.aspectWrapper.appendChild(iframe);\n\n    if (isLazy) {\n      // send to lazy iframe flow\n      iframe.setAttribute('data-iframely-url', src);\n      iframely.trigger('load', iframe);\n    } else {\n      iframe.setAttribute('src', src);\n      iframely.trigger('iframe-ready', iframe);\n    }\n  }\n}","var utils = require('./utils');\n\nvar iframely = require('./iframely'); // Need 'load' handler here instead of on('init') - we load lazy iframes only when DOM ready.\n\n\niframely.on('load', function (el) {\n  if (!el) {\n    // initial load\n    var elements = document.querySelectorAll('iframe[data-iframely-url]');\n\n    for (var i = 0; i < elements.length; i++) {\n      iframely.trigger('load', elements[i]);\n    }\n  }\n});\niframely.on('load', function (el) {\n  if (el && el.nodeName === 'IFRAME' && el.hasAttribute('data-iframely-url') && !el.hasAttribute('data-img') && !el.getAttribute('src')) {\n    loadLazyIframe(el);\n  }\n});\n\nfunction loadLazyIframe(el) {\n  var widget = utils.getWidget(el);\n  var src = el.getAttribute('data-iframely-url');\n\n  if (widget && src) {\n    src = utils.getEndpoint(src, {\n      lazy: iframely.config.intersection,\n      v: iframely.VERSION,\n      app: 1 // for example, will fall back to summary card if media is not longer available\n\n    });\n  }\n\n  el.setAttribute('src', src);\n  el.removeAttribute('data-iframely-url');\n  iframely.trigger('iframe-ready', el);\n}","// TODO: rename core.js to ready.js?\nvar iframely = require('./iframely');\n\nvar DOMReady = function DOMReady(f) {\n  if (document.readyState === 'complete' || document.readyState === 'interactive') {\n    // Run always (in case of async script).\n    setTimeout(f, 0);\n  }\n\n  document['addEventListener'] ? document['addEventListener']('DOMContentLoaded', f) : window.attachEvent('onload', f);\n};\n\nDOMReady(function () {\n  // Called each time on script load\n  iframely.trigger('load');\n});","var iframely = require('./iframely');\n\niframely.VERSION = 1;\niframely.ASPECT_WRAPPER_CLASS = 'iframely-responsive';\niframely.MAXWIDTH_WRAPPER_CLASS = 'iframely-embed';\niframely.LOADER_CLASS = 'iframely-loader';\niframely.DOMAINS = ['cdn.iframe.ly', 'iframe.ly', 'if-cdn.com', 'iframely.net'];\niframely.CDN = iframely.CDN || iframely.DOMAINS[0]; // default domain, user or script src can change CDN\n\niframely.BASE_RE = /^(?:https?:)?\\/\\/[^/]+/i;\niframely.ID_RE = /^(?:https?:)?\\/\\/[^/]+\\/(\\w+)(?:\\?.*)?$/;\niframely.SCRIPT_RE = /^(?:https?:|file:\\/)?\\/\\/[^/]+(?:.+)?\\/(?:embed|iframely)\\.js(?:[^/]+)?$/i;\niframely.CDN_RE = /^(?:https?:)?\\/\\/([^/]+)\\/(?:embed|iframely)\\.js(?:[^/]+)?$/i;\niframely.SUPPORTED_QUERY_STRING = ['api_key', 'key', 'iframe', 'html5', 'playerjs', 'align', 'language', 'media', 'maxwidth', 'lazy', 'import', 'parent', 'click_to_play', 'autoplay', 'mute', /^_.+/];\niframely.LAZY_IFRAME_SHOW_TIMEOUT = 3000;\niframely.LAZY_IFRAME_FADE_TIMEOUT = 200;\niframely.CLEAR_WRAPPER_STYLES_TIMEOUT = 3000;","var iframely = require('./iframely'); // deprecated. Helper function only, for the reverse compatibility.\n\n\niframely.widgets = iframely.widgets || {};\niframely.widgets.load = iframely.load;\n\nif (!iframely.events) {\n  iframely.events = {};\n  iframely.events.on = iframely.on;\n  iframely.events.trigger = iframely.trigger;\n}\n\niframely.on('cancel', function (url, parentNode, text, nextSibling) {\n  if (url && parentNode && text && text !== '') {\n    var a = document.createElement('a');\n    a.setAttribute('href', url);\n    a.setAttribute('target', '_blank');\n    a.setAttribute('rel', 'noopener');\n    a.textContent = text;\n\n    if (nextSibling) {\n      parentNode.insertBefore(a, nextSibling);\n    } else {\n      parentNode.appendChild(a);\n    }\n  }\n});","var utils = require('./utils');\n\nvar iframely = require('./iframely'); // widgetsCache is used from inside import doc for js callbacks and custom features\n\n\nvar widgetsCache = {};\niframely.on('load', function (el) {\n  // load once, if import is not in process and only if query-string from script src has not disabled import\n  if (!el && iframely.config.import !== false && isImportAble() && !iframely.import) {\n    var elements = document.querySelectorAll('a[data-iframely-url]:not([data-import-uri])');\n\n    if (elements.length > 1) {\n      makeImportAPICall(elements);\n    }\n  }\n});\niframely.on('load', function (widget, importOptions) {\n  if (widget && widget.uri && (widget.html || widget.cancel)) {\n    var els = widgetsCache[widget.uri]; // alternatively, could as well do querySelectorAll('a[data-iframely-url][data-import=\"' + template.getAttribute('data-uri') + '\"')\n\n    if (els) {\n      for (var i = 0; i < els.length; i++) {\n        loadImportWidget(widget, els[i], importOptions);\n      }\n    }\n\n    delete widgetsCache[widget.uri];\n  }\n});\n\nfunction makeImportAPICall(elements) {\n  var script = document.createElement('script');\n  var uris = [];\n  var ids = [];\n  var import_options = null; // will be populated from first element; or will remain as null if no params in elements...\n  // couple helper functions first\n\n  function pushElement(uri, el) {\n    if (!widgetsCache[uri]) {\n      widgetsCache[uri] = [];\n    }\n\n    widgetsCache[uri].push(el);\n  }\n\n  function queueElement(el) {\n    var src = el.getAttribute('data-iframely-url');\n    var mId = src.match(iframely.ID_RE);\n    var id = mId && mId[1];\n    var options = utils.parseQueryString(src, iframely.SUPPORTED_QUERY_STRING.concat('url'));\n    var url = options.url; // can be undefined for IDs\n\n    delete options.url; // skip import on import=0, playerjs=1\n\n    var skipImport = options.import === '0' || options.import === 'false' || options.playerjs === '1' || options.playerjs === 'true'; // or if link's query-string params or CDN are different from the others\n\n    if (!skipImport) {\n      var mBase = src.match(iframely.BASE_RE);\n      options.CDN = mBase && mBase[0]; // will fall back to iframely.CDN in getEndpoint('/import...' ...)\n      // set import options from the first el in import\n      // that includes api keys \n\n      if (!import_options) {\n        import_options = options; // else check that this el's options are the same as the first one's in import\n      } else if (JSON.stringify(options, Object.keys(options).sort()) !== JSON.stringify(import_options, Object.keys(import_options).sort())) {\n        skipImport = true;\n      }\n    }\n\n    if (skipImport) {\n      // Usual build if no uri and app=1s.\n      iframely.trigger('load', el);\n    } else if (id) {\n      el.setAttribute('data-import-uri', id);\n\n      if (ids.indexOf(id) === -1) {\n        ids.push(id);\n      }\n\n      pushElement(id, el);\n    } else {\n      if (!url) {\n        url = el.getAttribute('href');\n      }\n\n      var key = import_options.key || import_options.api_key || iframely.config.api_key || iframely.config.key;\n\n      if (key && url) {\n        el.setAttribute('data-import-uri', url);\n\n        if (uris.indexOf(url) === -1) {\n          uris.push(url);\n        }\n\n        pushElement(url, el);\n      } else {\n        // Usual build if no uri.\n        iframely.trigger('load', el);\n      }\n    }\n  } // start actual filling up of import request\n\n\n  for (var i = 0; i < elements.length; i++) {\n    var el = elements[i];\n\n    if (!el.getAttribute('data-import-uri') && el.hasAttribute('data-iframely-url')) {\n      queueElement(el);\n    }\n  }\n\n  if (uris.length > 0 || ids.length > 0) {\n    import_options = import_options || {};\n    import_options.touch = iframely.isTouch();\n    import_options.flash = hasFlash();\n    import_options.app = 1;\n\n    if (uris.length > 0) {\n      import_options.uri = uris;\n    }\n\n    if (ids.length > 0) {\n      import_options.ids = ids.join('&');\n    }\n\n    import_options.v = iframely.VERSION;\n    script.src = utils.getEndpoint('/api/import/v2', import_options, iframely.SUPPORTED_QUERY_STRING);\n\n    script.onerror = function () {\n      // Error loading import. No import this time.\n      importReady();\n    };\n\n    document.head.appendChild(script);\n    iframely.import = script;\n  } else {\n    importReady();\n    iframely.trigger('load');\n  }\n}\n\niframely.buildImportWidgets = function (importOptions) {\n  iframely.trigger('import-loaded', importOptions);\n  importOptions.widgets.forEach(function (widget) {\n    iframely.trigger('load', widget, importOptions);\n  });\n  importReady();\n};\n\nfunction loadImportWidget(widgetOptions, el, importOptions) {\n  var needCancelWidget = widgetOptions.cancel;\n  var shadow = widgetOptions.shadow;\n  var hasRenderedEvent = widgetOptions.renderEvent;\n  var wrapper = utils.getIframeWrapper(el, true);\n  var widget;\n\n  if (needCancelWidget) {\n    widget = utils.getWidget(el);\n    iframely.cancelWidget(widget || {\n      maxWidthWrapper: el,\n      iframe: el,\n      url: el.getAttribute('href')\n    });\n  } else {\n    widget = document.createElement('div');\n    widget.innerHTML = widgetOptions.html;\n    var parent, replacedEl;\n\n    if (wrapper && !hasRenderedEvent) {\n      // Inline widget will replace 'aspectWrapper' but keep 'maxWidthWrapper' as 'iframely-embed' to fix centering, etc.\n      // If has rendered event - keep wrapper and remove attrs later by event.\n      parent = wrapper.aspectWrapper.parentNode;\n      replacedEl = wrapper.aspectWrapper; // Clear custom attributes.\n\n      wrapper.maxWidthWrapper.removeAttribute('style');\n    } else {\n      // No wrapper or keep wrapper for later removal.\n      parent = el.parentNode;\n      replacedEl = el;\n    }\n\n    if (shadow) {\n      var shadowContainer = document.createElement('div');\n      var shadowRoot = shadowContainer.attachShadow({\n        mode: 'open'\n      });\n      shadowRoot.appendChild(widget);\n      var shadowWidgetOptions = {\n        shadowRoot: shadowRoot,\n        shadowContainer: shadowContainer,\n        container: parent,\n        context: widgetOptions.context,\n        stylesIds: widgetOptions.stylesIds,\n        stylesDict: importOptions.commonShadowStyles\n      };\n      iframely.trigger('import-shadow-widget-before-render', shadowWidgetOptions);\n      parent.insertBefore(shadowContainer, replacedEl);\n      iframely.trigger('import-shadow-widget-after-render', shadowWidgetOptions);\n    } else {\n      parent.insertBefore(widget, replacedEl);\n      exec_body_scripts(widget);\n    }\n\n    parent.removeChild(replacedEl);\n\n    if (hasRenderedEvent) {\n      setTimeout(function () {\n        clearWrapperStylesAndClass(parent);\n      }, iframely.CLEAR_WRAPPER_STYLES_TIMEOUT);\n    }\n  }\n}\n\nfunction importReady() {\n  delete iframely.import; // clean up all, let other loaders have a go\n\n  var failed_elements = document.querySelectorAll('a[data-iframely-url][data-import-uri]');\n\n  for (var i = 0; i < failed_elements.length; i++) {\n    failed_elements[i].removeAttribute('data-import-uri');\n    iframely.trigger('load', failed_elements[i]);\n  }\n}\n\niframely.isTouch = function () {\n  return 'ontouchstart' in window // works on most browsers\n  || navigator.maxTouchPoints; // works on IE10/11 and Surface\n};\n\nfunction hasFlash() {\n  var _hasFlash = false;\n\n  try {\n    var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n\n    if (fo) {\n      _hasFlash = true;\n    } else {\n      _hasFlash = false;\n    }\n  } catch (e) {\n    if (navigator.mimeTypes && navigator.mimeTypes['application/x-shockwave-flash'] != undefined && navigator.mimeTypes['application/x-shockwave-flash'].enabledPlugin) {\n      _hasFlash = true;\n    } else {\n      _hasFlash = false;\n    }\n  }\n\n  return _hasFlash;\n}\n\nfunction isImportAble() {\n  return document.head.attachShadow && (iframely.debug || document.location.protocol === 'http:' || document.location.protocol === 'https:') // Skip import on file:///\n  && !iframely.config.playerjs && !iframely.config.lazy; // && !navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n  // TODO: test in Firefox 63\n}\n\nfunction clearWrapperStylesAndClass(el) {\n  var aspectWrapper = el;\n  var parents = 0;\n\n  while (aspectWrapper && aspectWrapper.getAttribute('class') !== iframely.ASPECT_WRAPPER_CLASS) {\n    aspectWrapper = aspectWrapper.parentNode;\n    parents++;\n\n    if (parents > 4) {\n      // Do not search further 4 parents.\n      aspectWrapper = null;\n    }\n  }\n\n  var maxWidthWrapper = aspectWrapper && aspectWrapper.parentNode;\n\n  if (maxWidthWrapper && maxWidthWrapper.getAttribute('class') === iframely.MAXWIDTH_WRAPPER_CLASS) {\n    // Remove wrapper specific data. Leave only 'iframely-embed' parent class.\n    aspectWrapper.removeAttribute('style');\n    aspectWrapper.removeAttribute('class');\n    maxWidthWrapper.removeAttribute('style');\n  }\n}\n\niframely.on('import-widget-ready', clearWrapperStylesAndClass); // used in server templates\n\nif (!iframely.addEventListener) {\n  iframely.addEventListener = function (elem, type, eventHandle) {\n    if (!elem) {\n      return;\n    }\n\n    if (elem.addEventListener) {\n      elem.addEventListener(type, eventHandle, false);\n    } else if (elem.attachEvent) {\n      elem.attachEvent('on' + type, eventHandle);\n    } else {\n      elem['on' + type] = eventHandle;\n    }\n  };\n} // TODO: move to import script.\n\n\nfunction exec_body_scripts(body_el) {\n  function nodeName(elem, name) {\n    return elem.nodeName && elem.nodeName.toUpperCase() === name.toUpperCase();\n  }\n\n  function evalScript(elem) {\n    var data = elem.text || elem.textContent || elem.innerHTML || '',\n        script = document.createElement('script');\n\n    if (elem.src) {\n      script.src = elem.src;\n    }\n\n    script.type = 'text/javascript';\n\n    try {\n      // doesn't work on ie...\n      script.appendChild(document.createTextNode(data));\n    } catch (e) {\n      // IE has funky script nodes\n      script.text = data;\n    }\n\n    body_el.appendChild(script);\n  } // main section of function\n\n\n  var scripts = [],\n      script,\n      children_nodes = body_el.childNodes,\n      child,\n      i;\n\n  for (i = 0; children_nodes[i]; i++) {\n    child = children_nodes[i];\n\n    if (nodeName(child, 'script') && (!child.type || child.type.toLowerCase() === 'text/javascript' || child.type.toLowerCase() === 'application/javascript')) {\n      scripts.push(child);\n      body_el.removeChild(child);\n    } else {\n      exec_body_scripts(child);\n    }\n  }\n\n  for (i = 0; scripts[i]; i++) {\n    script = scripts[i];\n\n    if (script.parentNode) {\n      script.parentNode.removeChild(script);\n    }\n\n    evalScript(scripts[i]);\n  }\n}","require('./dom-ready');\n\nvar iframely = require('./iframely');\n\nif (!iframely._loaded) {\n  iframely._loaded = true;\n\n  require('./const');\n\n  require('./events'); // require('./utils');\n\n\n  require('./intersection');\n\n  require('./import');\n\n  require('./ahref');\n\n  require('./lazy-img-placeholder');\n\n  require('./lazy-iframe'); // require('./messaging');\n\n\n  require('./widget-cancel');\n\n  require('./widget-resize');\n\n  require('./widget-click');\n\n  require('./widget-options');\n\n  require('./deprecated');\n\n  iframely.trigger('init');\n}\n\nexports.iframely = iframely;","var iframely = require('./iframely');\n\niframely.on('message', function (widget, message) {\n  if (message.method === 'setIframelyEmbedOptions') {\n    // console.log('setIframelyEmbedOptions', message.data);\n    iframely.trigger('options', widget, message.data);\n  }\n});"],"sourceRoot":""}